!function(){var a=function(){var a={},b=function(b,c,d){for(var e=b.split("."),f=0;f<e.length-1;f++)d[e[f]]||(d[e[f]]={}),d=d[e[f]];"function"==typeof c?c.isClass?d[e[f]]=c:d[e[f]]=function(){return c.apply(a,arguments)}:d[e[f]]=c},c=function(c,d,e){b(c,d,a),e&&b(c,d,window.filepicker)},d=function(b,d,e){"function"==typeof b&&(e=d,d=b,b=""),b&&(b+=".");var f=d.call(a);for(var g in f)c(b+g,f[g],e)},e=function(b){b.apply(a,arguments)};return{extend:d,internal:e}}();if(window.filepicker)for(attr in a)window.filepicker[attr]=a[attr];else window.filepicker=a}(),filepicker.extend("ajax",function(){var a=this,b=function(a,b){b.method="GET",f(a,b)},c=function(b,c){c.method="POST",b+=(b.indexOf("?")>=0?"&":"?")+"_cacheBust="+a.util.getId(),f(b,c)},d=function(b,c){var e=[];for(var f in b){var g=b[f];c&&(f=c+"["+f+"]");var h;switch(a.util.typeOf(g)){case"object":h=d(g,f);break;case"array":for(var i={},j=0;j<g.length;j++)i[j]=g[j];h=d(i,f);break;default:h=f+"="+encodeURIComponent(g)}null!==g&&e.push(h)}return e.join("&")},e=function(){try{return new window.XMLHttpRequest}catch(a){try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return null}}}},f=function(b,c){b=b||"";var f=c.method?c.method.toUpperCase():"POST",h=c.success||function(){},i=c.error||function(){},j=void 0===c.async||c.async,k=c.data||null,l=void 0===c.processData||c.processData,m=c.headers||{},n=a.util.parseUrl(b),o=window.location.protocol+"//"+window.location.host,p=o!==n.origin,q=!1;k&&l&&(k=d(c.data));var r;if(c.xhr)r=c.xhr;else if(r=e(),!r)return c.error("Ajax not allowed"),r;if(p&&window.XDomainRequest&&!("withCredentials"in r))return g(b,c);c.progress&&r.upload&&r.upload.addEventListener("progress",function(a){a.lengthComputable&&c.progress(Math.round(95*a.loaded/a.total))},!1);var s=function(){if(4==r.readyState&&!q)if(c.progress&&c.progress(100),r.status>=200&&r.status<300){var b=r.responseText;if(c.json)try{b=a.json.decode(b)}catch(a){return void t.call(r,"Invalid json: "+b)}h(b,r.status,r),q=!0}else t.call(r,r.responseText),q=!0};r.onreadystatechange=s;var t=function(a){if(!q)return c.progress&&c.progress(100),q=!0,400==this.status?void i("bad_params",this.status,this):403==this.status?void i("not_authorized",this.status,this):404==this.status?void i("not_found",this.status,this):p?4==this.readyState&&0===this.status?void i("CORS_not_allowed",this.status,this):void i("CORS_error",this.status,this):void i(a,this.status,this)};r.onerror=t,k&&"GET"==f&&(b+=(b.indexOf("?")!=-1?"&":"?")+k,k=null),r.open(f,b,j),c.json?r.setRequestHeader("Accept","application/json, text/javascript"):r.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*");var u=m["Content-Type"]||m["content-type"];if(k&&l&&("POST"==f||"PUT"==f)&&void 0==u&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),m)for(var v in m)r.setRequestHeader(v,m[v]);return r.send(k),r},g=function(b,c){if(!window.XDomainRequest)return null;var e=c.method?c.method.toUpperCase():"POST",f=c.success||function(){},g=c.error||function(){},h=c.data||{};if("http:"==window.location.protocol?b=b.replace("https:","http:"):"https:"==window.location.protocol&&(b=b.replace("http:","https:")),c.async)throw new a.FilepickerException("Asyncronous Cross-domain requests are not supported");"GET"!=e&&"POST"!=e&&(h._method=e,e="POST"),c.processData!==!1&&(h=h?d(h):null),h&&"GET"==e&&(b+=(b.indexOf("?")>=0?"&":"?")+h,h=null),b+=(b.indexOf("?")>=0?"&":"?")+"_xdr=true&_cacheBust="+a.util.getId();var i=new window.XDomainRequest;return i.onload=function(){var b=i.responseText;if(c.progress&&c.progress(100),c.json)try{b=a.json.decode(b)}catch(a){return void g("Invalid json: "+b,200,i)}f(b,200,i)},i.onerror=function(){c.progress&&c.progress(100),g(i.responseText||"CORS_error",this.status||500,this)},i.onprogress=function(){},i.ontimeout=function(){},i.timeout=3e4,i.open(e,b,!0),i.send(h),i};return{get:b,post:c,request:f}}),filepicker.extend("base64",function(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var a=function(a,b){b=b||void 0===b;var d,e,f,g,h,i,j,k="",l=0;for(b&&(a=c(a));l<a.length;)d=a.charCodeAt(l),e=a.charCodeAt(l+1),f=a.charCodeAt(l+2),l+=3,g=d>>2,h=(3&d)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k=k+_keyStr.charAt(g)+_keyStr.charAt(h)+_keyStr.charAt(i)+_keyStr.charAt(j);return k},b=function(a,b){b=b||void 0===b;var c,e,f,g,h,i,j,k="",l=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)g=_keyStr.indexOf(a.charAt(l)),h=_keyStr.indexOf(a.charAt(l+1)),i=_keyStr.indexOf(a.charAt(l+2)),j=_keyStr.indexOf(a.charAt(l+3)),l+=4,c=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,k+=String.fromCharCode(c),64!=i&&(k+=String.fromCharCode(e)),64!=j&&(k+=String.fromCharCode(f));return b&&(k=d(k)),k},c=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},d=function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b};return{encode:a,decode:b}},!0),filepicker.extend("browser",function(){var a=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))},b=function(){return!!navigator.userAgent.match(/Android/i)},c=function(){return!!navigator.userAgent.match(/MSIE 7\.0/i)};return{isIOS:a,isAndroid:b,isIE7:c}}),filepicker.extend("comm",function(){var a=this,b="filepicker_comm_iframe",c=function(){if(void 0===window.frames[b]){f();var c;c=document.createElement("iframe"),c.id=c.name=b,c.src=a.urls.COMM,c.style.display="none",document.body.appendChild(c)}},d=function(b){if(b.origin==a.urls.BASE){var c=a.json.parse(b.data);a.handlers.run(c)}},e=!1,f=function(){if(!e)if(e=!0,window.addEventListener)window.addEventListener("message",d,!1);else{if(!window.attachEvent)throw new a.FilepickerException("Unsupported browser");window.attachEvent("onmessage",d)}},g=function(){if(window.removeEventListener)window.removeEventListener("message",d,!1);else{if(!window.attachEvent)throw new a.FilepickerException("Unsupported browser");window.detachEvent("onmessage",d)}if(e){e=!1;for(var c=document.getElementsByName(b),f=0;f<c.length;f++)c[f].parentNode.removeChild(c[f]);try{delete window.frames[b]}catch(a){}}};return{openChannel:c,closeChannel:g}}),filepicker.extend("comm_fallback",function(){var a,b=this,c="filepicker_comm_iframe",d="host_comm_iframe",e="",f=200,g=function(){h()},h=function(){if(void 0===window.frames[d]){var a;a=document.createElement("iframe"),a.id=a.name=d,e=a.src=b.urls.constructHostCommFallback(),a.style.display="none";var c=function(){e=a.contentWindow.location.href,i()};a.attachEvent?a.attachEvent("onload",c):a.onload=c,document.body.appendChild(a)}},i=function(){if(void 0===window.frames[c]){var a;a=document.createElement("iframe"),a.id=a.name=c,a.src=b.urls.FP_COMM_FALLBACK+"?host_url="+encodeURIComponent(e),a.style.display="none",document.body.appendChild(a)}n()},j=!1,k=void 0,l="",m=function(){var a=window.frames[c];if(a){var e=a.frames[d];if(e){var f=e.location.hash;if(f&&"#"==f.charAt(0)&&(f=f.substr(1)),f!==l&&(l=f)){var g;try{g=b.json.parse(f)}catch(a){}g&&b.handlers.run(g)}}}},n=function(){j||(j=!0,k=window.setInterval(m,f))},o=function(){if(window.clearInterval(k),j){j=!1;for(var a=document.getElementsByName(c),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b]);try{delete window.frames[c]}catch(a){}for(a=document.getElementsByName(d),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b]);try{delete window.frames[d]}catch(a){}}},p=!("postMessage"in window),q=function(){a=b.comm,b.comm={openChannel:g,closeChannel:o}};return p&&q(),{openChannel:g,closeChannel:o,isEnabled:p}}),filepicker.extend("conversions",function(){var a=this,b={width:"number",height:"number",fit:"string",format:"string",watermark:"string",watermark_size:"number",watermark_position:"string",align:"string",crop:"string or array",quality:"number",text:"string",text_font:"string",text_size:"number",text_color:"string",text_align:"string",text_padding:"number",policy:"string",signature:"string",storeLocation:"string",storePath:"string",storeAccess:"string",rotate:"string or number"},c=function(c){var d;for(var e in c){d=!1;for(var f in b)if(e==f&&(d=!0,b[f].indexOf(a.util.typeOf(c[e]))===-1))throw new a.FilepickerException("Conversion parameter "+e+" is not the right type: "+c[e]+". Should be a "+b[f]);if(!d)throw new a.FilepickerException("Conversion parameter "+e+" is not a valid parameter.")}},d=function(b,d,e,f,g){c(d),d.crop&&a.util.isArray(d.crop)&&(d.crop=d.crop.join(",")),a.ajax.post(b+"/convert",{data:d,json:!0,success:function(b){e(a.util.standardizeFPFile(b))},error:function(b,c,d){f("not_found"==b?new a.errors.FPError(141):"bad_params"==b?new a.errors.FPError(142):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(143))},progress:g})};return{convert:d}}),filepicker.extend("cookies",function(){var a=this,b=function(b){var c=function(c){"ThirdPartyCookies"===c.type&&(a.cookies.THIRD_PARTY_COOKIES=!!c.payload,b&&"function"==typeof b&&b(!!c.payload))};return c},c=function(c){var d=b(c);a.handlers.attach("cookies",d),a.comm.openChannel()};return{checkThirdParty:c}}),filepicker.extend("dragdrop",function(){var a=this,b=function(){return(!!window.FileReader||navigator.userAgent.indexOf("Safari")>=0)&&"draggable"in document.createElement("span")},c=function(c,d){var e="No DOM element found to create drop pane";if(!c)throw new a.FilepickerException(e);if(c.jquery){if(0===c.length)throw new a.FilepickerException(e);c=c[0]}if(!b())return a.util.console.error("Your browser doesn't support drag-drop functionality"),!1;d=d||{};var f=d.dragEnter||function(){},g=d.dragLeave||function(){},h=d.onStart||function(){},i=d.onSuccess||function(){},j=d.onError||function(){},k=d.onProgress||function(){},l=d.mimetypes;l||(l=d.mimetype?[d.mimetype]:["*/*"]),"string"==a.util.typeOf(l)&&(l=l.split(","));var m=d.extensions;m||d.extension&&(m=[d.extensions]),"string"==a.util.typeOf(m)&&(m=m.split(","));var n={location:d.location,path:d.path,access:d.access,policy:d.policy,signature:d.signature};c.addEventListener("dragenter",function(a){return f(),a.stopPropagation(),a.preventDefault(),!1},!1),c.addEventListener("dragleave",function(a){return g(),a.stopPropagation(),a.preventDefault(),!1},!1),c.addEventListener("dragover",function(a){return a.preventDefault(),!1},!1),c.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault();var c,d,e;if(b.dataTransfer.items)for(d=b.dataTransfer.items,c=0;c<d.length;c++)if(e=d[c]&&d[c].webkitGetAsEntry?d[c].webkitGetAsEntry():void 0,e&&e.isDirectory)return void j("WrongType","Uploading a folder is not allowed");var f=b.dataTransfer.files,g=f.length;if(u(f))for(h(f),c=0;c<f.length;c++)a.store(f[c],n,q(c,g),r,s(c,g))});var o={},p=[],q=function(a,b){return function(c){d.multiple?(p.push(c),p.length==b?(i(p),p=[]):(o[a]=100,t(b))):i([c])}},r=function(a){j("UploadError",a.toString())},s=function(a,b){return function(c){o[a]=c,t(b)}},t=function(a){var b=0;for(var c in o)b+=o[c];var d=b/a;k(d)},u=function(b){if(b.length>0){if(b.length>1&&!d.multiple)return j("TooManyFiles","Only one file at a time"),!1;for(var c,e,f,g=0;g<b.length;g++){c=!1,e=b[g],f=e.name||e.fileName||'"Unknown file"';for(var h=0;h<l.length;h++){var i=a.mimetypes.getMimetype(e);c=c||a.mimetypes.matchesMimetype(i,l[h])}if(!c)return j("WrongType",f+" isn't the right type of file"),!1;if(m){for(c=!1,h=0;h<m.length;h++)c=c||a.util.endsWith(f,m[h]);if(!c)return j("WrongType",f+" isn't the right type of file"),!1}if(e.size&&d.maxSize&&e.size>d.maxSize)return j("WrongSize",f+" is too large ("+e.size+" Bytes)"),!1}return!0}return j("NoFilesFound","No files uploaded"),!1};return!0};return{enabled:b,makeDropPane:c}}),filepicker.extend("errors",function(){var a=this,b=function(a){if(this===window)return new b(a);if(this.code=a,filepicker.debug){var c=filepicker.error_map[this.code];this.message=c.message,this.moreInfo=c.moreInfo,this.toString=function(){return"FPError "+this.code+": "+this.message+". For help, see "+this.moreInfo}}else this.toString=function(){return"FPError "+this.code+". Include filepicker_debug.js for more info"};return this};b.isClass=!0;var c=function(b){filepicker.debug&&a.util.console.error(b.toString())};return{FPError:b,handleError:c}},!0),filepicker.extend("exporter",function(){var a=this,b=function(b){var c=function(c,d,e){b[d]&&!a.util.isArray(b[d])?b[d]=[b[d]]:b[c]?b[d]=[b[c]]:e&&(b[d]=e)};if(b.mimetype&&b.extension)throw a.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the export function");if(c("service","services"),b.services)for(var d=0;d<b.services.length;d++){var e=(""+b.services[d]).replace(" ",""),f=a.services[e];b.services[d]=void 0===f?e:f}b.openTo&&(b.openTo=a.services[b.openTo]||b.openTo),a.util.setDefault(b,"container","modal")},c=function(b,c){var d=function(d){if("filepickerUrl"===d.type){if(d.error)a.util.console.error(d.error),c(a.errors.FPError(132));else{var e={};e.url=d.payload.url,e.filename=d.payload.data.filename,e.mimetype=d.payload.data.type,e.size=d.payload.data.size,e.isWriteable=!0,b(e)}a.modal.close()}};return d},d=function(e,f,g,h){if(b(f),f.debug)return void setTimeout(function(){g({url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979})},1);if(void 0===a.cookies.THIRD_PARTY_COOKIES)return void a.cookies.checkThirdParty(function(){d(e,f,g,h)});var i=a.util.getId(),j=!1,k=function(a){j=!0,g(a)},l=function(a){j=!0,h(a)},m=function(){j||(j=!0,h(a.errors.FPError(131)))};"modal"==f.container&&(f.mobile||a.window.shouldForce())&&(f.container="window"),a.window.open(f.container,a.urls.constructExportUrl(e,f,i),m),a.handlers.attach(i,c(k,l))};return{createExporter:d}}),filepicker.extend("files",function(){var a=this,b=function(b,d,e,f,g){var h=void 0===d.base64encode;h&&(d.base64encode=!0),d.base64encode=d.base64encode!==!1;var i=function(b){h&&(b=a.base64.decode(b,!!d.asText)),e(b)};c.call(this,b,d,i,f,g)},c=function(b,c,d,e,f){c.cache!==!0&&(c._cacheBust=a.util.getId()),a.ajax.get(b,{data:c,headers:{"X-NO-STREAM":!0},success:d,error:function(b,c,d){e("CORS_not_allowed"==b?new a.errors.FPError(113):"CORS_error"==b?new a.errors.FPError(114):"not_found"==b?new a.errors.FPError(115):"bad_params"==b?new a.errors.FPError(400):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(118))},progress:f})},d=function(b,c,d,e,f){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return f(10),void a.files.storeFile(b,{},function(b){f(50),a.files.readFromFPUrl(b.url,c,d,e,function(a){f(50+a/2)})},e,function(a){f(a/2)});var g=!!c.base64encode,h=!!c.asText,i=new FileReader;i.onprogress=function(a){a.lengthComputable&&f(Math.round(a.loaded/a.total*100))},i.onload=function(b){f(100),d(g?a.base64.encode(b.target.result,h):b.target.result)},i.onerror=function(b){switch(b.target.error.code){case b.target.error.NOT_FOUND_ERR:e(new a.errors.FPError(115));break;case b.target.error.NOT_READABLE_ERR:e(new a.errors.FPError(116));break;case b.target.error.ABORT_ERR:e(new a.errors.FPError(117));break;default:e(new a.errors.FPError(118))}},h||!i.readAsBinaryString?i.readAsText(b):i.readAsBinaryString(b)},e=function(b,c,d,e,f,g){var h=d.mimetype||"text/plain";a.ajax.post(a.urls.constructWriteUrl(b,d),{headers:{"Content-Type":h},data:c,processData:!1,json:!0,success:function(b){e(a.util.standardizeFPFile(b))},error:function(b,c,d){f("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))},progress:g})},f=function(b,c,d,e,f,g){var h=function(b,c,d){f("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))},i=function(b){e(a.util.standardizeFPFile(b))};k(c,a.urls.constructWriteUrl(b,d),i,h,g)},g=function(b,c,d,e,f,g){var h=function(b,c,d){f("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))},i=function(b){e(a.util.standardizeFPFile(b))};d.mimetype=c.type,k(c,a.urls.constructWriteUrl(b,d),i,h,g)},h=function(b,c,d,e,f,g){a.ajax.post(a.urls.constructWriteUrl(b,d),{data:{url:c},json:!0,success:function(b){e(a.util.standardizeFPFile(b))},error:function(b,c,d){f("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))},progress:g})},i=function(b,c,d,e,f){if(b.files)return void(0===b.files.length?e(new a.errors.FPError(115)):j(b.files[0],c,d,e,f));a.util.setDefault(c,"storage","S3"),c.filename||(c.filename=b.value.replace("C:\\fakepath\\","")||b.name);var g=b.name;b.name="fileUpload",a.iframeAjax.post(a.urls.constructStoreUrl(c),{data:b,processData:!1,json:!0,success:function(c){b.name=g,d(a.util.standardizeFPFile(c))},error:function(b,c,d){e("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))}})},j=function(b,c,d,e,f){a.util.setDefault(c,"storage","S3");var g=function(b,c,d){"not_found"==b?e(new a.errors.FPError(121)):"bad_params"==b?e(new a.errors.FPError(122)):"not_authorized"==b?e(new a.errors.FPError(403)):(a.util.console.error(b),e(new a.errors.FPError(123)))},h=function(b){d(a.util.standardizeFPFile(b))};c.filename||(c.filename=b.name||b.fileName),k(b,a.urls.constructStoreUrl(c),h,g,f)},k=function(b,c,d,e,f){b.files&&(b=b.files[0]);var g=!!window.FormData&&!!window.XMLHttpRequest;g?(data=new FormData,data.append("fileUpload",b),a.ajax.post(c,{json:!0,processData:!1,data:data,success:d,error:e,progress:f})):a.iframeAjax.post(c,{data:b,json:!0,success:d,error:e})},l=function(b,c,d,e,f){a.util.setDefault(c,"storage","S3"),a.util.setDefault(c,"mimetype","text/plain"),a.ajax.post(a.urls.constructStoreUrl(c),{headers:{"Content-Type":c.mimetype},data:b,processData:!1,json:!0,success:function(b){d(a.util.standardizeFPFile(b))},error:function(b,c,d){e("not_found"==b?new a.errors.FPError(121):"bad_params"==b?new a.errors.FPError(122):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(123))},progress:f})},m=function(b,c,d,e,f){a.util.setDefault(c,"storage","S3"),a.ajax.post(a.urls.constructStoreUrl(c),{data:{url:b},json:!0,success:function(b){d(a.util.standardizeFPFile(b))},error:function(b,c,d){e("not_found"==b?new a.errors.FPError(151):"bad_params"==b?new a.errors.FPError(152):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(153))},progress:f})},n=function(b,c,d,e){var f=["uploaded","modified","created"];c.cache!==!0&&(c._cacheBust=a.util.getId()),a.ajax.get(b+"/metadata",{json:!0,data:c,success:function(a){for(var b=0;b<f.length;b++)a[f[b]]&&(a[f[b]]=new Date(a[f[b]]));d(a)},error:function(b,c,d){e("not_found"==b?new a.errors.FPError(161):"bad_params"==b?new a.errors.FPError(400):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(162))}})},o=function(b,c,d,e){c.key=a.apikey,a.ajax.post(b+"/remove",{data:c,success:function(a){d()},error:function(b,c,d){e("not_found"==b?new a.errors.FPError(171):"bad_params"==b?new a.errors.FPError(400):"not_authorized"==b?new a.errors.FPError(403):new a.errors.FPError(172))}})};return{readFromUrl:c,readFromFile:d,readFromFPUrl:b,writeDataToFPUrl:e,writeFileToFPUrl:g,writeFileInputToFPUrl:f,writeUrlToFPUrl:h,storeFileInput:i,storeFile:j,storeUrl:m,storeData:l,stat:n,remove:o}}),filepicker.extend("handlers",function(){var a={},b=function(b,c){return a.hasOwnProperty(b)?a[b].push(c):a[b]=[c],c},c=function(b,c){var d=a[b];if(d)if(c){for(var e=0;e<d.length;e++)if(d[e]===c){d.splice(e,1);break}0===d.length&&delete a[b]}else delete a[b]},d=function(b){var c=b.id;if(a.hasOwnProperty(c)){for(var d=a[c],e=0;e<d.length;e++)d[e](b);return!0}return!1};return{attach:b,detach:c,run:d}}),filepicker.extend("iframeAjax",function(){var a=this,b="ajax_iframe",c=[],d=!1,e=function(a,b){b.method="GET",h(a,b)},f=function(b,c){c.method="POST",b+=(b.indexOf("?")>=0?"&":"?")+"_cacheBust="+a.util.getId(),h(b,c)},g=function(){if(c.length>0){var a=c.shift();h(a.url,a.options)}},h=function(e,f){if(d)return void c.push({url:e,options:f});e+=(e.indexOf("?")>=0?"&":"?")+"_cacheBust="+a.util.getId(),e+="&Content-Type=text%2Fhtml",a.comm.openChannel();var g;try{g=document.createElement('<iframe name="'+b+'">')}catch(a){g=document.createElement("iframe")}g.id=g.name=b,g.style.display="none";var h=function(){d=!1};g.attachEvent?(g.attachEvent("onload",h),g.attachEvent("onerror",h)):g.onerror=g.onload=h,g.id=b,g.name=b,g.style.display="none",g.onerror=g.onload=function(){d=!1},document.body.appendChild(g),a.handlers.attach("upload",i(f));var k=document.createElement("form");k.method=f.method||"GET",k.action=e,k.target=b;var l=f.data;if((a.util.isFileInputElement(l)||a.util.isFile(l))&&(k.encoding=k.enctype="multipart/form-data"),document.body.appendChild(k),a.util.isFile(l)){var m=j(l);if(!m)throw a.FilepickerException("Couldn't find corresponding file input.");l={fileUpload:m}}else if(a.util.isFileInputElement(l)){var n=l;l={},l.fileUpload=n}else l&&a.util.isElement(l)&&"INPUT"==l.tagName?(n=l,l={},l[n.name]=n):f.processData!==!1&&(l={data:l});l.format="iframe";var o={};for(var p in l){var q=l[p];if(a.util.isElement(q)&&"INPUT"==q.tagName)o[p]={par:q.parentNode,sib:q.nextSibling,name:q.name,input:q,focused:q==document.activeElement},q.name=p,k.appendChild(q);else{var r=document.createElement("input");r.name=p,r.value=q,k.appendChild(r)}}d=!0,window.setTimeout(function(){k.submit();for(var a in o){var b=o[a];b.par.insertBefore(b.input,b.sib),b.input.name=b.name,b.focused&&b.input.focus()}k.parentNode.removeChild(k)},1)},i=function(b){var c=b.success||function(){},e=b.error||function(){},f=function(b){if("Upload"===b.type){d=!1;var f=b.payload;f.error?e(f.error):c(f),a.handlers.detach("upload"),g()}};return f},j=function(a){for(var b=document.getElementsByTagName("input"),c=0;c<b.length;c++){var d=b[0];if("file"==d.type&&d.files&&d.files.length)for(var e=0;e<d.files.length;e++)if(d.files[e]===a)return d}return null};return{get:e,post:f,request:h}}),filepicker.extend("json",function(){var a=this,b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c=function(a){return b[a]||"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)},d=function(a){return a=a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(a)},e=function(b){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(b);b&&b.toJSON&&(b=b.toJSON());var d=[];switch(a.util.typeOf(b)){case"string":return'"'+b.replace(/[\x00-\x1f\\"]/g,c)+'"';case"array":for(var f=0;f<b.length;f++)d.push(e(b[f]));return"["+d+"]";case"object":case"hash":var g,h;for(h in b)g=e(b[h]),g&&d.push(e(h)+":"+g),g=null;return"{"+d+"}";case"number":case"boolean":return""+b;case"null":return"null";default:return"null"}return null},f=function(b,c){if(!b||"string"!=a.util.typeOf(b))return null;if(window.JSON&&window.JSON.parse)return window.JSON.parse(b);if(c&&!d(b))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");return eval("("+b+")")};return{validate:d,encode:e,stringify:e,decode:f,parse:f}}),filepicker.extend(function(){var a=this;a.API_VERSION="v1";var b=function(b){a.apikey=b},c=function(a){return this.text=a,this.toString=function(){return"FilepickerException: "+this.text},this};c.isClass=!0;var d=function(){if(!a.apikey)throw new a.FilepickerException("API Key not found")},e=function(b,c,e){d(),"function"==typeof b&&(e=c,c=b,b={}),b=b||{},c=c||function(){},e=e||a.errors.handleError,a.picker.createPicker(b,c,e,!1)},f=function(b,c,e){d(),"function"==typeof b&&(e=c,c=b,b={}),b=b||{},c=c||function(){},e=e||a.errors.handleError,a.picker.createPicker(b,c,e,!0)},g=function(b,c,e,f){if(d(),!b||!c||"function"==typeof b||"function"==typeof b)throw new a.FilepickerException("Not all required parameters given, missing picker or store options");f=f||a.errors.handleError;var g=!!b.multiple,h=b?a.util.clone(b):{};if(h.storeLocation=c.location||"S3",h.storePath=c.path,h.storeAccess=c.access||"private",g&&h.storePath&&"/"!=h.storePath.charAt(h.storePath.length-1))throw new a.FilepickerException("pickAndStore with multiple files requires a path that ends in '/'");var i=e;g||(i=function(a){e([a])}),a.picker.createPicker(h,i,f,g)},h=function(b,c,e,f,g){if(d(),!b)throw new a.FilepickerException("No input given - nothing to read!");if("function"==typeof c&&(g=f,f=e,e=c,c={}),c=c||{},e=e||function(){},f=f||a.errors.handleError,g=g||function(){},"string"==typeof b)a.util.isFPUrl(b)?a.files.readFromFPUrl(b,c,e,f,g):a.files.readFromUrl(b,c,e,f,g);else if(a.util.isFileInputElement(b))b.files?0===b.files.length?f(new a.errors.FPError(115)):a.files.readFromFile(b.files[0],c,e,f,g):i(b,c,e,f,g);else if(a.util.isFile(b))a.files.readFromFile(b,c,e,f,g);else{if(!b.url)throw new a.FilepickerException("Cannot read given input: "+b+". Not a url, file input, DOM File, or FPFile object.");a.files.readFromFPUrl(b.url,c,e,f,g)}},i=function(b,c,d,e,f){f(10),a.store(b,function(b){f(50),a.read(b,c,d,e,function(a){f(50+a/2)})},e)},j=function(b,c,e,f,g,h){if(d(),!b)throw new a.FilepickerException("No fpfile given - nothing to write to!");if(void 0===c||null===c)throw new a.FilepickerException("No input given - nothing to write!");"function"==typeof e&&(h=g,g=f,f=e,e={}),e=e||{},f=f||function(){},g=g||a.errors.handleError,h=h||function(){};var i;if(a.util.isFPUrl(b))i=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to write to: "+b+". Not a filepicker url or FPFile object.");i=b.url}if("string"==typeof c)a.files.writeDataToFPUrl(i,c,e,f,g,h);else if(a.util.isFileInputElement(c))c.files?0===c.files.length?g(new a.errors.FPError(115)):a.files.writeFileToFPUrl(i,c.files[0],e,f,g,h):a.files.writeFileInputToFPUrl(i,c,e,f,g,h);else if(a.util.isFile(c))a.files.writeFileToFPUrl(i,c,e,f,g,h);else{if(!c.url)throw new a.FilepickerException("Cannot read from given input: "+c+". Not a string, file input, DOM File, or FPFile object.");a.files.writeUrlToFPUrl(i,c.url,e,f,g,h)}},k=function(b,c,e,f,g,h){if(d(),!b)throw new a.FilepickerException("No fpfile given - nothing to write to!");if(void 0===c||null===c)throw new a.FilepickerException("No input given - nothing to write!");"function"==typeof e&&(h=g,g=f,f=e,e={}),e=e||{},f=f||function(){},g=g||a.errors.handleError,h=h||function(){};var i;if(a.util.isFPUrl(b))i=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to write to: "+b+". Not a filepicker url or FPFile object.");i=b.url}a.files.writeUrlToFPUrl(i,c,e,f,g,h)},l=function(b,c,e,f){d(),"function"==typeof c&&(f=e,e=c,c={}),c=c?a.util.clone(c):{},e=e||function(){},f=f||a.errors.handleError;var g;if("string"==typeof b&&a.util.isUrl(b))g=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to export: "+b+". Not a valid url or FPFile object. You may want to use filepicker.store() to get an FPFile to export");g=b.url,c.mimetype||c.extension||(c.mimetype=b.mimetype),c.suggestedFilename||(c.suggestedFilename=b.filename)}a.exporter.createExporter(g,c,e,f)},m=function(b,c,e,f,g){if(d(),"function"==typeof c&&(g=f,f=e,e=c,c={}),c=c?a.util.clone(c):{},e=e||function(){},f=f||a.errors.handleError,g=g||function(){},"string"==typeof b)a.files.storeData(b,c,e,f,g);else if(a.util.isFileInputElement(b))b.files?0===b.files.length?f(new a.errors.FPError(115)):a.files.storeFile(b.files[0],c,e,f,g):a.files.storeFileInput(b,c,e,f,g);else if(a.util.isFile(b))a.files.storeFile(b,c,e,f,g);else{if(!b.url)throw new a.FilepickerException("Cannot store given input: "+b+". Not a string, file input, DOM File, or FPFile object.");c.filename||(c.filename=b.filename),a.files.storeUrl(b.url,c,e,f,g)}},n=function(b,c,e,f,g){d(),"function"==typeof c&&(g=f,f=e,e=c,c={}),c=c||{},e=e||function(){},f=f||a.errors.handleError,g=g||function(){},a.files.storeUrl(b,c,e,f,g)},o=function(b,c,e,f){d(),"function"==typeof c&&(f=e,e=c,c={}),c=c||{},e=e||function(){},f=f||a.errors.handleError;var g;if(a.util.isFPUrl(b))g=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to get metadata for: "+b+". Not a filepicker url or FPFile object.");g=b.url}a.files.stat(g,c,e,f)},p=function(b,c,e,f){d(),"function"==typeof c&&(f=e,e=c,c={}),c=c||{},e=e||function(){},f=f||a.errors.handleError;var g;if(a.util.isFPUrl(b))g=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to remove: "+b+". Not a filepicker url or FPFile object.");g=b.url}a.files.remove(g,c,e,f)},q=function(b,c,e,f,g,h){if(d(),!b)throw new a.FilepickerException("No fpfile given - nothing to convert!");"function"==typeof e&&(h=g,g=f,f=e,e={}),options=c?a.util.clone(c):{},e=e||{},f=f||function(){},g=g||a.errors.handleError,h=h||function(){},e.location&&(options.storeLocation=e.location),e.path&&(options.storePath=e.path),options.storeAccess=e.access||"private";var i;if(a.util.isFPUrl(b))i=b;else{if(!b.url)throw new a.FilepickerException("Invalid file to convert: "+b+". Not a filepicker url or FPFile object.");if(i=b.url,!a.mimetypes.matchesMimetype(b.mimetype,"image/*"))return void g(new a.errors.FPError(142))}a.conversions.convert(i,options,f,g,h)},r=function(b){return a.widgets.constructWidget(b)},s=function(b,c){return a.dragdrop.makeDropPane(b,c)};return{setKey:b,pick:e,pickMultiple:f,pickAndStore:g,read:h,write:j,writeUrl:k,export:l,exportFile:l,store:m,storeUrl:n,stat:o,metadata:o,remove:p,convert:q,constructWidget:r,makeDropPane:s,FilepickerException:c}},!0),filepicker.extend("mimetypes",function(){var a=this,b={".stl":"applicaiton/sla",".hbs":"text/html",".pdf":"application/pdf",".jpg":"image/jpeg",".jpeg":"image/jpeg",".jpe":"image/jpeg",".imp":"application/x-impressionist"},c=["application/octet-stream","application/download","application/force-download","octet/stream","application/unknown","application/x-download","application/x-msdownload","application/x-secure-download"],d=function(a){if(a.type){var d=a.type;d=d.toLowerCase();for(var e=!1,f=0;f<c.length;f++)e=e||d==c[f];if(!e)return a.type}var g=a.name||a.fileName,h=g.match(/\.\w*$/);return h?b[h[0].toLowerCase()]||"":a.type?a.type:""},e=function(b,d){if(!b)return"*/*"==d;b=a.util.trim(b).toLowerCase(),d=a.util.trim(d).toLowerCase();for(var e=0;e<c.length;e++)if(b==c[e])return!0;return test_parts=b.split("/"),against_parts=d.split("/"),"*"==against_parts[0]||against_parts[0]==test_parts[0]&&("*"==against_parts[1]||against_parts[1]==test_parts[1])};return{getMimetype:d,matchesMimetype:e}}),filepicker.extend("modal",function(){var a=this,b="filepicker_shade",c="filepicker_dialog_container",d=function(b,c){var d=e(c),h=f(),i=g(c),j=document.createElement("iframe");j.name=a.window.WINDOW_NAME,j.id=a.window.WINDOW_NAME;var k=a.window.getSize(),l=Math.min(k[1]-40,500);return j.style.width="100%",j.style.height=l-32+"px",j.style.border="none",j.style.position="relative",j.setAttribute("border",0),j.setAttribute("frameborder",0),j.setAttribute("frameBorder",0),j.setAttribute("marginwidth",0),j.setAttribute("marginheight",0),j.src=b,document.body.appendChild(d),h.appendChild(i),h.appendChild(j),document.body.appendChild(h),j},e=function(a){var c=document.createElement("div");return c.id=b,
c.style.position="fixed",c.style.top=0,c.style.bottom=0,c.style.right=0,c.style.left=0,c.style.backgroundColor="#000000",c.style.opacity="0.5",c.style.filter="alpha(opacity=50)",c.style.zIndex=1e4,c.onclick=h(a),c},f=function(){var b=document.createElement("div");b.id=c,b.style.position="fixed",b.style.padding="10px",b.style.background='#ffffff url("https://www.filepicker.io/static/img/spinner.gif") no-repeat 50% 50%',b.style.top="10px",b.style.bottom="auto",b.style.right="auto";var d=a.window.getSize(),e=Math.min(d[1]-40,500),f=Math.max(Math.min(d[0]-40,800),620),g=(d[0]-f-40)/2;return b.style.left=g+"px",b.style.height=e+"px",b.style.width=f+"px",b.style.overflow="hidden",b.style.webkitOverflowScrolling="touch",b.style.border="1px solid #999",b.style.webkitBorderRadius="3px",b.style.borderRadius="3px",b.style.margin="0",b.style.webkitBoxShadow="0 3px 7px rgba(0, 0, 0, 0.3)",b.style.boxShadow="0 3px 7px rgba(0, 0, 0, 0.3)",b.style.zIndex=10001,b.style.boxSizing="content-box",b.style.webkitBoxSizing="content-box",b.style.mozBoxSizing="content-box",b},g=function(a){var b=document.createElement("a");return b.appendChild(document.createTextNode("Ã—")),b.onclick=h(a),b.style.cssFloat="right",b.style.styleFloat="right",b.style.cursor="default",b.style.padding="0 5px 0 0px",b.style.fontSize="1.5em",b.style.color="#555555",b.style.textDecoration="none",b},h=function(d,e){return e=!!e,function(){if(!a.uploading||e||window.confirm("You are currently uploading. If you choose 'OK', the window will close and your upload will not finish. Do you want to stop uploading and close the window?")){a.uploading=!1;var f=document.getElementById(b);f&&document.body.removeChild(f);var g=document.getElementById(c);g&&document.body.removeChild(g);try{delete window.frames[a.window.WINDOW_NAME]}catch(a){}d&&d()}}},i=h(function(){});return{generate:d,close:i}}),filepicker.extend("picker",function(){var a=this,b=function(b){var c=function(c,d,e){b[d]?a.util.isArray(b[d])||(b[d]=[b[d]]):b[c]?b[d]=[b[c]]:e&&(b[d]=e)};if(c("service","services"),c("mimetype","mimetypes"),c("extension","extensions"),b.services)for(var d=0;d<b.services.length;d++){var e=(""+b.services[d]).replace(" ","");void 0!==a.services[e]&&(e=a.services[e]),b.services[d]=e}if(b.mimetypes&&b.extensions)throw a.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the pick function");b.mimetypes||b.extensions||(b.mimetypes=["*/*"]),b.openTo&&(b.openTo=a.services[b.openTo]||b.openTo),a.util.setDefault(b,"container","modal")},c=function(b,c){var d=function(d){if("filepickerUrl"===d.type){if(a.uploading=!1,d.error)a.util.console.error(d.error),c(a.errors.FPError(102));else{var e={};e.url=d.payload.url,e.filename=d.payload.data.filename,e.mimetype=d.payload.data.type,e.size=d.payload.data.size,d.payload.data.key&&(e.key=d.payload.data.key),e.isWriteable=!0,b(e)}a.modal.close()}};return d},d=function(b){b=b||function(){};var c=function(c){"uploading"===c.type&&(a.uploading=!!c.payload,b(a.uploading))};return c},e=function(b,c){var d=function(d){if("filepickerUrl"===d.type){if(a.uploading=!1,d.error)a.util.console.error(d.error),c(a.errors.FPError(102));else{var e=[];a.util.isArray(d.payload)||(d.payload=[d.payload]);for(var f=0;f<d.payload.length;f++){var g={},h=d.payload[f];g.url=h.url,g.filename=h.data.filename,g.mimetype=h.data.type,g.size=h.data.size,h.data.key&&(g.key=h.data.key),g.isWriteable=!0,e.push(g)}b(e)}a.modal.close()}};return d},f=function(g,h,i,j){if(b(g),g.debug)return void setTimeout(function(){h({url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979})},1);if(void 0===a.cookies.THIRD_PARTY_COOKIES)return void a.cookies.checkThirdParty(function(){f(g,h,i,!!j)});var k=a.util.getId(),l=!1,m=function(a){l=!0,h(a)},n=function(a){l=!0,i(a)},o=function(){l||(l=!0,i(a.errors.FPError(101)))};"modal"==g.container&&(g.mobile||a.window.shouldForce())&&(g.container="window"),a.window.open(g.container,a.urls.constructPickUrl(g,k,j),o);var p=j?e(m,n):c(m,n);a.handlers.attach(k,p);var q=k+"-upload";a.handlers.attach(q,d(function(){a.handlers.detach(q)}))};return{createPicker:f}}),filepicker.extend("services",function(){return{COMPUTER:1,DROPBOX:2,FACEBOOK:3,GITHUB:4,GMAIL:5,IMAGE_SEARCH:6,URL:7,WEBCAM:8,GOOGLE_DRIVE:9,SEND_EMAIL:10,INSTAGRAM:11,FLICKR:12,VIDEO:13,EVERNOTE:14,PICASA:15,WEBDAV:16,FTP:17,ALFRESCO:18,BOX:19,SKYDRIVE:20}},!0),filepicker.extend("util",function(){var a=function(a){return a.replace(/^\s+|\s+$/g,"")},b=/^(http|https)\:.*\/\//i,c=function(a){return!!a.match(b)},d=function(a){a&&"/"!=a.charAt(0)||(a=window.location.protocol+"//"+window.location.host+a);var b=document.createElement("a");b.href=a;var c=b.hostname.indexOf(":")==-1?b.hostname:b.host,d={source:a,protocol:b.protocol.replace(":",""),host:c,port:b.port,query:b.search,params:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;f<e;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:b.hash.replace("#",""),path:b.pathname.replace(/^([^\/])/,"/$1"),relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:b.pathname.replace(/^\//,"").split("/")};return d.origin=d.protocol+"://"+d.host+(d.port?":"+d.port:""),d},e=function(a,b){return a.indexOf(b,a.length-b.length)!==-1};return{trim:a,parseUrl:d,isUrl:c,endsWith:e}}),filepicker.extend("urls",function(){var a=this,b="https://www.filepicker.io";window.filepicker.hostname&&(b=window.filepicker.hostname);var c=b+"/dialog/open/",d=b+"/dialog/save/",e=b+"/api/store/",f=function(b,d,e){return c+"?key="+a.apikey+"&id="+d+"&referrer="+window.location.hostname+"&iframe="+("window"!=b.container)+"&version="+a.API_VERSION+(b.services?"&s="+b.services.join(","):"")+(e?"&multi="+!!e:"")+(void 0!==b.mimetypes?"&m="+b.mimetypes.join(","):"")+(void 0!==b.extensions?"&ext="+b.extensions.join(","):"")+(void 0!==b.openTo?"&loc="+b.openTo:"")+(b.maxSize?"&maxSize="+b.maxSize:"")+(b.signature?"&signature="+b.signature:"")+(b.policy?"&policy="+b.policy:"")+(void 0!==b.mobile?"&mobile="+b.mobile:"")+(b.storeLocation?"&storeLocation="+b.storeLocation:"")+(b.storePath?"&storePath="+b.storePath:"")+(b.storeAccess?"&storeAccess="+b.storeAccess:"")},g=function(b,c,e){return(b.indexOf("&")>=0||b.indexOf("?")>=0)&&(b=encodeURIComponent(b)),d+"?url="+b+"&key="+a.apikey+"&id="+e+"&referrer="+window.location.hostname+"&iframe="+("window"!=c.container)+"&version="+a.API_VERSION+(c.services?"&s="+c.services.join(","):"")+(void 0!==c.openTo?"&loc="+c.openTo:"")+(void 0!==c.mimetype?"&m="+c.mimetype:"")+(void 0!==c.extension?"&ext="+c.extension:"")+(void 0!==c.mobile?"&mobile="+c.mobile:"")+(void 0!==c.suggestedFilename?"&defaultSaveasName="+c.suggestedFilename:"")+(c.signature?"&signature="+c.signature:"")+(c.policy?"&policy="+c.policy:"")},h=function(b){return e+b.storage+"?key="+a.apikey+(b.base64decode?"&base64decode=true":"")+(b.mimetype?"&mimetype="+b.mimetype:"")+(b.filename?"&filename="+b.filename:"")+(b.path?"&path="+b.path:"")+(b.access?"&access="+b.access:"")+(b.signature?"&signature="+b.signature:"")+(b.policy?"&policy="+b.policy:"")},i=function(a,b){return a+"?nonce=fp"+(b.base64decode?"&base64decode=true":"")+(b.mimetype?"&mimetype="+b.mimetype:"")+(b.signature?"&signature="+b.signature:"")+(b.policy?"&policy="+b.policy:"")},j=function(){var b=a.util.parseUrl(window.location.href);return b.origin+"/404"};return{BASE:b,COMM:b+"/dialog/comm_iframe/",FP_COMM_FALLBACK:b+"/dialog/comm_hash_iframe/",STORE:e,PICK:c,EXPORT:d,constructPickUrl:f,constructExportUrl:g,constructWriteUrl:i,constructStoreUrl:h,constructHostCommFallback:j}}),filepicker.extend("util",function(){var a=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},b=function(a){return a&&"[object File]"===Object.prototype.toString.call(a)},c=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},d=function(a){return c(a)&&"INPUT"==a.tagName&&"file"==a.type},e=function(c){return null===c?"null":a(c)?"array":b(c)?"file":typeof c},f=function(){var a=new Date;return a.getTime().toString()},g=function(a,b,c){void 0===a[b]&&(a[b]=c)},h=function(a){if(window.jQuery)window.jQuery(function(){a()});else{var b="load";if(window.addEventListener)window.addEventListener(b,a,!1);else if(window.attachEvent)window.attachEvent("on"+b,a);else if(window.onload){var c=window.onload;window.onload=function(){c(),a()}}else window.onload=a}},i=function(a){return"string"==typeof a&&a.match("www.filepicker.io/api/file/")},j=function(a){return function(){if(window.console&&"function"==typeof window.console[a])try{window.console[a].apply(window.console,arguments)}catch(a){alert(Array.prototype.join.call(arguments,","))}}},k={};k.log=j("log"),k.error=j("error");var l=function(a){var b={};for(key in a)b[key]=a[key];return b},m=function(a){var b={};return b.url=a.url,b.filename=a.filename||a.name,b.mimetype=a.mimetype||a.type,b.size=a.size,b.key=a.key||a.s3_key,b.isWriteable=!(!a.isWriteable&&!a.writeable),b};return{isArray:a,isFile:b,isElement:c,isFileInputElement:d,getId:f,setDefault:g,typeOf:e,addOnLoad:h,isFPUrl:i,console:k,clone:l,standardizeFPFile:m}}),filepicker.extend("widgets",function(){var a=this,b=function(a,b,c,d){var e=d.getAttribute(c);e&&(b[a]=e)},c=function(a,b){var c;document.createEvent?(c=document.createEvent("Event"),c.initEvent("change",!0,!1),c.fpfile=b?b[0]:void 0,c.fpfiles=b,a.dispatchEvent(c)):document.createEventObject?(c=document.createEventObject("Event"),c.eventPhase=2,c.currentTarget=c.srcElement=c.target=a,c.fpfile=b?b[0]:void 0,c.fpfiles=b,a.fireEvent("onchange",c)):a.onchange&&a.onchange(b)},d=function(d){var e=document.createElement("button");e.setAttribute("type","button"),e.innerHTML=d.getAttribute("data-fp-button-text")||d.getAttribute("data-fp-text")||"Pick File",e.className=d.getAttribute("data-fp-button-class")||d.getAttribute("data-fp-class")||d.className,d.style.display="none";var f={};b("container",f,"data-fp-option-container",d),b("maxSize",f,"data-fp-option-maxsize",d),b("mimetype",f,"data-fp-mimetype",d),b("mimetypes",f,"data-fp-mimetypes",d),b("extension",f,"data-fp-extension",d),b("extensions",f,"data-fp-extensions",d),b("container",f,"data-fp-container",d),b("maxSize",f,"data-fp-maxSize",d),b("openTo",f,"data-fp-openTo",d),b("debug",f,"data-fp-debug",d),b("signature",f,"data-fp-signature",d),b("policy",f,"data-fp-policy",d),b("storeLocation",f,"data-fp-store-location",d),b("storePath",f,"data-fp-store-path",d),b("storeAccess",f,"data-fp-store-access",d);var g=d.getAttribute("data-fp-services");if(g||(g=d.getAttribute("data-fp-option-services")),g){g=g.split(",");for(var h=0;h<g.length;h++)g[h]=a.services[g[h].replace(" ","")];f.services=g}var i=d.getAttribute("data-fp-service");i&&(f.service=a.services[i.replace(" ","")]),f.mimetypes&&(f.mimetypes=f.mimetypes.split(",")),f.extensions&&(f.extensions=f.extensions.split(","));var j=d.getAttribute("data-fp-apikey");j&&a.setKey(j);var k="true"==(d.getAttribute("data-fp-multiple")||d.getAttribute("data-fp-option-multiple")||"false");k?e.onclick=function(){return e.blur(),a.pickMultiple(f,function(a){for(var b=[],e=0;e<a.length;e++)b.push(a[e].url);d.value=b.join(),c(d,a)}),!1}:e.onclick=function(){return e.blur(),a.pick(f,function(a){d.value=a.url,c(d,[a])}),!1},d.parentNode.insertBefore(e,d)},e=function(d){var e=document.createElement("div");e.className=d.getAttribute("data-fp-class")||d.className,e.style.padding="1px",d.style.display="none",d.parentNode.insertBefore(e,d);var i=document.createElement("button");i.setAttribute("type","button"),i.innerHTML=d.getAttribute("data-fp-button-text")||"Pick File",i.className=d.getAttribute("data-fp-button-class")||"",e.appendChild(i);var j=document.createElement("div");g(j),j.innerHTML=d.getAttribute("data-fp-drag-text")||"Or drop files here",j.className=d.getAttribute("data-fp-drag-class")||"",e.appendChild(j);var k={};b("container",k,"data-fp-option-container",d),b("maxSize",k,"data-fp-option-maxsize",d),b("mimetype",k,"data-fp-mimetype",d),b("mimetypes",k,"data-fp-mimetypes",d),b("extension",k,"data-fp-extension",d),b("extensions",k,"data-fp-extensions",d),b("container",k,"data-fp-container",d),b("maxSize",k,"data-fp-maxSize",d),b("openTo",k,"data-fp-openTo",d),b("debug",k,"data-fp-debug",d),b("signature",k,"data-fp-signature",d),b("policy",k,"data-fp-policy",d),b("storeLocation",k,"data-fp-store-location",d),b("storePath",k,"data-fp-store-path",d),b("storeAccess",k,"data-fp-store-access",d);var l=d.getAttribute("data-fp-services");if(l||(l=d.getAttribute("data-fp-option-services")),l){l=l.split(",");for(var m=0;m<l.length;m++)l[m]=a.services[l[m].replace(" ","")];k.services=l}var n=d.getAttribute("data-fp-service");n&&(k.service=a.services[n.replace(" ","")]),k.mimetypes&&(k.mimetypes=k.mimetypes.split(",")),k.extensions&&(k.extensions=k.extensions.split(","));var o=d.getAttribute("data-fp-apikey");o&&a.setKey(o);var p="true"==(d.getAttribute("data-fp-multiple")||d.getAttribute("data-fp-option-multiple")||"false");a.dragdrop.enabled()?h(j,p,k,d):j.innerHTML="&nbsp;",p?j.onclick=i.onclick=function(){return i.blur(),a.pickMultiple(k,function(a){for(var b=[],e=[],g=0;g<a.length;g++)b.push(a[g].url),e.push(a[g].filename);d.value=b.join(),f(d,j,e.join(", ")),c(d,a)}),!1}:j.onclick=i.onclick=function(){return i.blur(),a.pick(k,function(a){d.value=a.url,f(d,j,a.filename),c(d,[a])}),!1}},f=function(b,d,e){d.innerHTML=e,d.style.padding="2px 4px",d.style.cursor="default",d.style.width="";var f=document.createElement("span");f.innerHTML="X",f.style.borderRadius="8px",f.style.fontSize="14px",f.style.cssFloat="right",f.style.padding="0 3px",f.style.color="#600",f.style.cursor="pointer";var h=function(e){return e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),g(d),a.dragdrop.enabled?d.innerHTML=b.getAttribute("data-fp-drag-text")||"Or drop files here":d.innerHTML="&nbsp;",b.value="",c(b),!1};f.addEventListener?f.addEventListener("click",h,!1):f.attachEvent&&f.attachEvent("onclick",h),d.appendChild(f)},g=function(a){a.style.border="1px dashed #AAA",a.style.display="inline-block",a.style.margin="0 0 0 4px",a.style.borderRadius="3px",a.style.backgroundColor="#F3F3F3",a.style.color="#333",a.style.fontSize="14px",a.style.lineHeight="22px",a.style.padding="2px 4px",a.style.verticalAlign="middle",a.style.cursor="pointer",a.style.overflow="hidden"},h=function(b,d,e,g){var h,j=b.innerHTML;a.dragdrop.makeDropPane(b,{multiple:d,maxSize:e.maxSize,mimetypes:e.mimetypes,mimetype:e.mimetype,extensions:e.extensions,extension:e.extension,location:e.storeLocation,path:e.storePath,access:e.storeAccess,policy:e.policy,signature:e.signature,dragEnter:function(){b.innerHTML="Drop to upload",b.style.backgroundColor="#E0E0E0",b.style.border="1px solid #000"},dragLeave:function(){b.innerHTML=j,b.style.backgroundColor="#F3F3F3",b.style.border="1px dashed #AAA"},onError:function(a,c){"TooManyFiles"==a?b.innerHTML=c:"WrongType"==a?b.innerHTML=c:"NoFilesFound"==a?b.innerHTML=c:"UploadError"==a&&(b.innerHTML="Oops! Had trouble uploading.")},onStart:function(a){h=i(b)},onProgress:function(a){h&&(h.style.width=a+"%")},onSuccess:function(a){for(var d=[],e=[],h=0;h<a.length;h++)d.push(a[h].url),e.push(a[h].filename);g.value=d.join(),f(g,b,e.join(", ")),c(g,a)}})},i=function(a){var b=document.createElement("div"),c=a.offsetHeight-2;return b.style.height=c+"px",b.style.backgroundColor="#0E90D2",b.style.width="2%",b.style.borderRadius="3px",a.style.width=a.offsetWidth+"px",a.style.padding="0",a.style.border="1px solid #AAA",a.style.backgroundColor="#F3F3F3",a.style.boxShadow="inset 0 1px 2px rgba(0, 0, 0, 0.1)",a.innerHTML="",a.appendChild(b),b},j=function(c){c.onclick=function(){var d=c.getAttribute("data-fp-url");if(!d)return!0;var e={};b("container",e,"data-fp-option-container",c),b("suggestedFilename",e,"data-fp-option-defaultSaveasName",c),b("container",e,"data-fp-container",c),b("suggestedFilename",e,"data-fp-suggestedFilename",c),b("mimetype",e,"data-fp-mimetype",c),b("extension",e,"data-fp-extension",c);var f=c.getAttribute("data-fp-services");if(f||(f=c.getAttribute("data-fp-option-services")),f){f=f.split(",");for(var g=0;g<f.length;g++)f[g]=a.services[f[g].replace(" ","")];e.services=f}var h=c.getAttribute("data-fp-service");return h&&(e.service=a.services[h.replace(" ","")]),apikey=c.getAttribute("data-fp-apikey"),apikey&&a.setKey(apikey),a.exportFile(d,e),!1}},k=function(){if(document.querySelectorAll){var a,b=document.querySelectorAll('input[type="filepicker"]');for(a=0;a<b.length;a++)d(b[a]);var c=document.querySelectorAll('input[type="filepicker-dragdrop"]');for(a=0;a<c.length;a++)e(c[a]);var f=[],g=document.querySelectorAll("button[data-fp-url]");for(a=0;a<g.length;a++)f.push(g[a]);for(g=document.querySelectorAll("a[data-fp-url]"),a=0;a<g.length;a++)f.push(g[a]);for(g=document.querySelectorAll('input[type="button"][data-fp-url]'),a=0;a<g.length;a++)f.push(g[a]);for(a=0;a<f.length;a++)j(f[a])}},l=function(a){a.jquery&&(a=a[0]);var b=a.getAttribute("type");"filepicker"==b?d(a):"filepicker-dragdrop"==b?e(a):j(a)};return{constructPickWidget:d,constructDragWidget:e,constructExportWidget:j,buildWidgets:k,constructWidget:l}}),filepicker.extend("window",function(){var a=this,b="filepicker_dialog",c="left=100,top=100,height=600,width=800,menubar=no,toolbar=no,location=no,personalbar=no,status=no,resizable=yes,scrollbars=yes,dependent=yes,dialog=yes",d=1e3,e=function(){return document.body&&document.body.offsetWidth&&(winW=document.body.offsetWidth,winH=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(winW=document.documentElement.offsetWidth,winH=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(winW=window.innerWidth,winH=window.innerHeight),[winW,winH]},f=function(){var b=e()[0]<768,c=a.cookies.THIRD_PARTY_COOKIES===!1;return a.browser.isIOS()||a.browser.isAndroid()||b||c},g=function(e,g,h){if(h=h||function(){},e||(e="modal"),"modal"==e&&f()&&(e="window"),"window"==e)var i=b+a.util.getId(),j=window.open(g,i,c),k=window.setInterval(function(){j&&!j.closed||(window.clearInterval(k),h())},d);else if("modal"==e)a.modal.generate(g,h);else{var l=document.getElementById(e);if(!l)throw new a.FilepickerException("Container '"+e+"' not found. This should either be set to 'window','modal', or the ID of an iframe that is currently in the document.");l.src=g}};return{open:g,WINDOW_NAME:b,getSize:e,shouldForce:f}}),function(){filepicker.internal(function(){var a=this;a.util.addOnLoad(a.cookies.checkThirdParty),a.util.addOnLoad(a.widgets.buildWidgets)}),delete filepicker.internal,delete filepicker.extend;var a,b=filepicker._queue||[],c=b.length;if(c)for(var d=0;d<c;d++)a=b[d],filepicker[a[0]].apply(filepicker,a[1]);delete filepicker._queue}();var avpw_swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(a){return}R=!0;for(var b=N.length,c=0;c<b;c++)N[c]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(d<10)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;b<a;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;o<n;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;f<e;f++)(1!=d[f].nodeType||"PARAM"!=d[f].nodeName)&&8!=d[f].nodeType&&b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(a){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),e=c?/mac/.test(c):/mac/.test(b),f=!!/webkit/.test(b)&&parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),g=!1,h=[0,0,0],i=null;if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,i&&(typeof L.mimeTypes==C||!L.mimeTypes[G]||!!L.mimeTypes[G].enabledPlugin)&&(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J.ActiveXObject!=C)try{var j=new ActiveXObject(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(a){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();(function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&function(){if(!R){try{K.documentElement.doScroll("left")}catch(a){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&function(){if(!R)return/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))})(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;b<a;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;d<c;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in avpw_swfobject)avpw_swfobject[f]=null;avpw_swfobject=null})}();return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(U.w3)return g(a)},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();!function(a,b,c){var d=/\s+/;a.Events={on:function(a,b,c){var e,f,g;if(!b)return this;for(a=a.split(d),e=this._callbacks||(this._callbacks={});f=a.shift();)g=e[f]||(e[f]=[]),g.push(b,c);return this},off:function(a,b,c){var e,f,g,h;if(!(f=this._callbacks))return this;if(!(a||b||c))return delete this._callbacks,this;for(a=a?a.split(d):_.keys(f);e=a.shift();)if((g=f[e])&&(b||c))for(h=g.length-2;h>=0;h-=2)b&&g[h]!==b||c&&g[h+1]!==c||g.splice(h,2);else delete f[e];return this},trigger:function(a){var b,c,e,f,g,h,i,j;if(!(c=this._callbacks))return this;for(j=[],a=a.split(d),f=1,g=arguments.length;f<g;f++)j[f-1]=arguments[f];for(;b=a.shift();){if((i=c.all)&&(i=i.slice()),(e=c[b])&&(e=e.slice()),e)for(f=0,g=e.length;f<g;f+=2)e[f].apply(e[f+1]||this,j);if(i)for(h=[b].concat(j),f=0,g=i.length;f<g;f+=2)i[f].apply(i[f+1]||this,h)}return this}}}(window.AV||(window.AV={}),window,document),"undefined"==typeof AV&&(AV={}),AV.JSON={},function(){"use strict";function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof AV.JSON.stringify&&(AV.JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("AV.JSON.stringify")}),"function"!=typeof AV.JSON.parse&&(AV.JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j
},""):j;throw new SyntaxError("AV.JSON.parse")})}(),function(a){a.build={version:"2.6.2.182",bundled:!1,MINIMUM_FLASH_PLAYER_VERSION:"10.2.0",feather_baseURL:"http://feather.aviary.com/2.6.2.182/",feather_baseURL_SSL:"https://dme0ih8comzn4.cloudfront.net/2.6.2.182/",feather_stickerURL:"http://feather.aviary.com/stickers/",feather_stickerURL_SSL:"https://dme0ih8comzn4.cloudfront.net/stickers/",imgrecvBase:"http://featherservices.aviary.com/",imgrecvBase_SSL:"https://featherservices.aviary.com/",featherTargetAnnounce:"http://featherservices.aviary.com/feather_target_announce_v3.html",featherTargetAnnounce_SSL:"https://featherservices.aviary.com/feather_target_announce_v3.html",imgrecvServer:"http://featherservices.aviary.com/FeatherReceiver.aspx",imgrecvServer_SSL:"https://featherservices.aviary.com/FeatherReceiver.aspx",jsonp_imgserver:"http://featherservices.aviary.com/imgjsonpserver.aspx",jsonp_imgserver_SSL:"https://featherservices.aviary.com/imgjsonpserver.aspx",proxyServer:"http://featherservices.aviary.com/proxy.aspx",proxyServer_SSL:"https://featherservices.aviary.com/proxy.aspx",asyncImgrecvBase:"http://api.aviary.com/",asyncImgrecvBase_SSL:"https://api.aviary.com/",partnerAssetURL:"http://api.aviary.com/getassets",partnerAssetURL_SSL:"https://api.aviary.com/getassets",asyncFeatherTargetAnnounce:"http://api.aviary.com/feather_target_announce_v3.html",asyncFeatherTargetAnnounce_SSL:"https://api.aviary.com/feather_target_announce_v3.html",asyncImgrecvCreateJob:"http://api.aviary.com/createjob",asyncImgrecvCreateJob_SSL:"https://api.aviary.com/createjob",asyncImgrecvGetJobStatus:"http://api.aviary.com/getjobstatus",asyncImgrecvGetJobStatus_SSL:"https://api.aviary.com/getjobstatus",imgtrackServer:"http://featherservices.aviary.com/featherlog.aspx",imgtrackServer_SSL:"https://featherservices.aviary.com/featherlog.aspx",googleTracker:"UA-84575-16",inAppPurchaseFrameURL:"http://purchases.viary.com/gateway.aspx?p=flickr",filterServer:"http://featherservices.aviary.com/moa.ashx",filterServer_SSL:"https://featherservices.aviary.com/moa.ashx",featherFilterAnnounce:"http://featherservices.aviary.com/feather_filter_announce.html",featherFilterAnnounce_SSL:"https://featherservices.aviary.com/feather_filter_announce.html"}}(AV=window.AV||{}),"undefined"==typeof AV&&(AV={}),AV.validLanguages={en:!0,zh_hant:!0,nl:!0,fr:!0,de:!0,it:!0,ja:!0,ko:!0,pl:!0,pt:!0,pt_br:!0,ru:!0,es:!0,tr:!0,bg:!0,ca:!0,zh_hans:!0,cs:!0,da:!0,fi:!0,he:!0,hu:!0,id:!0,lv:!0,lt:!0,sv:!0,vi:!0,no:!0,android:!0,sk:!0,el:!0,sl:!0},function(a,b,c){a.util={getX:function(a){for(var b=0;null!=a;)b+=a.offsetLeft,a=a.offsetParent;return b},getY:function(a){for(var b=0;null!=a;)b+=a.offsetTop,a=a.offsetParent;return b},getTouch:function(a){var b;return a.originalEvent&&(a=a.originalEvent),b=a.changedTouches&&1==a.changedTouches.length?a.changedTouches[0]:!(!a.touches||1!=a.touches.length)&&a.touches[0]},getScaledDims:function(a,b,c,d){d=d||c;var e=a,f=b,g=a/b;return(a>c||b>d)&&(a-c>g*(b-d)?(e=c,f=c*b/a+.5|0):(e=d*g+.5|0,f=d)),{width:e,height:f}},nextFrame:function(a){setTimeout(a,1)},getDomain:function(a,b){var c,d,e,f,g,h,i;return c="http://"==a.substr(0,7)?7:"https://"==a.substr(0,8)?8:"ftp://"==a.substr(0,6)?6:0,e=a.indexOf("/",c),e==-1&&(e=a.length),b?d=c:(h=a,i=a.lastIndexOf(":"),h=i>c?a.substring(c,i):a.substring(c,e),h.match(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/)?d=c:(f=a.lastIndexOf(".",e),g=a.lastIndexOf(".",f-1),d=g==-1?c:g+1)),a.substring(d,e)},extend:function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||jQuery.isFunction(g)||(g={}),i===h&&(g=this,--h);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(jQuery.isPlainObject(d)||(e=jQuery.isArray(d)))?(e?(e=!1,f=c&&jQuery.isArray(c)?c:[]):f=c&&jQuery.isPlainObject(c)?c:{},g[b]=jQuery.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},findItemByKeyValueFromArray:function(a,b,c){var d,e;c.length;for(d=0;d<c.length;d++)if(c[d]&&c[d][a]&&c[d][a]===b){e=c[d];break}return e},loadFile:function(){var a,b,d,e,f=0,g=function(a,b){function c(a){4!=this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||b(a)}b&&("Microsoft Internet Explorer"==navigator.appName?a.onreadystatechange=c:a.onload=b)};return a=g,function(g,h,i){var j;return"js"==h?(j=c.createElement("script"),j.setAttribute("type","text/javascript"),a(j,i),j.setAttribute("src",g)):"css"==h?c.createStyleSheet?c.createStyleSheet(g,f++):(j=c.createElement("link"),j.setAttribute("rel","stylesheet"),j.setAttribute("type","text/css"),j.setAttribute("href",g)):"img"==h&&(j=c.createElement("img"),a(j,i),j.setAttribute("src",g)),j&&(b=b||c.getElementsByTagName("head")[0],"js"==h?b.appendChild(j):"css"==h&&(d=d||c.createDocumentFragment(),d.appendChild(j),b.insertBefore(j,e))),j}}(),getImageElem:function(a){return"string"==typeof a?c.getElementById(a):a.length?a[0]:a},getImageId:function(a){return"string"==typeof a?a:a.id},imgOnLoad:function(a,b){var c=avpw$(a);c.load(b),1!=c[0].complete&&4!=c[0].readyState&&"complete"!=c[0].readyState&&"loaded"!=c[0].readyState||c.trigger("load")},color_is_white:function(a){return a=a.toLowerCase(),"#fff"==a||"#ffffff"==a||"white"==a||"rgb(255,255,255)"==a||"rgb(255, 255, 255)"==a},color_is_light:function(b){var c,d,e,f,g;return c=d=e=0,g=a.util.color_to_array(b),c=g[0],d=g[1],e=g[2],f=.2*c+.7*d+.1*e,f>127.5},color_expand:function(a){var b,c,d;return 4==a.length&&(b=a.charAt(1),c=a.charAt(2),d=a.charAt(3),a="#"+b+b+c+c+d+d),a},color_to_array:function(b){var c,d,e;return"#"==b.charAt(0)?(b=a.util.color_expand(b),c=parseInt(b.substr(1,2),16),d=parseInt(b.substr(3,2),16),e=parseInt(b.substr(5,2),16)):"r"==b.charAt(0).toLowerCase()&&(b=a.util.rgb_to_color(b),c=parseInt(b.substr(1,2),16),d=parseInt(b.substr(3,2),16),e=parseInt(b.substr(5,2),16)),b=[c,d,e,1]},array_to_color:function(b){var c=a.util.array_to_rgb(b);return c=a.util.rgb_to_color(c)},array_to_rgb:function(a){var b="rgb(0,0,0)";return a.join&&(a.length>3&&(a=a.slice(0,3)),b="rgb("+a.join(",")+")"),b},color_to_rgb:function(b){return b=a.util.color_to_array(b),b=a.util.array_to_rgb(b)},rgb_to_color:function(a){var b,c,d,e=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/,f=a.match(e);return f?(b=parseInt(f[1]).toString(16),1==b.length&&(b="0"+b),c=parseInt(f[2]).toString(16),1==c.length&&(c="0"+c),d=parseInt(f[3]).toString(16),1==d.length&&(d="0"+d),"#"+b+c+d):a},color_to_int:function(b){return b=a.util.color_expand(b),b=a.util.rgb_to_color(b),parseInt(b.substr(1),16)},loadImagesSync:function(b,c){for(var d=0,e=b.length,f=0;f<e;f++){var g=b[f].img,h=b[f].src;g.onload=function(){d++,c&&d==b.length&&a.util.nextFrame(c)},g.src=h}},getApiVersion:function(a){return a&&a.apiVersion?parseInt(a.apiVersion,10):1},addFontToPage:function(b,c){b||c&&c();var d=b.label;b.system?c&&c(b):a.WebFont&&(b.familyStyle&&(d+=":"+b.familyStyle),a.WebFont.load({google:{families:[d]},loading:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!0)},active:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!1),c&&c(b)},inactive:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!1),a.errorNotify("UNSUPPORTED_FONT",[d]),c&&c()}}))}}}(window.AV||(window.AV={}),window,document),"undefined"==typeof AV&&(AV={}),AV.FlashAPI=function(){var a="avpw_canvas_swf",b=null,c=function(){var a=function(a,b,c){var d=document.createElement("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)},b=function(b,c,d){var e=document.getElementById(d);if(e)if("undefined"==typeof b.id&&(b.id=d),AV.msie){var f="";for(var g in b)b[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?c.movie=b[g]:"styleclass"==g.toLowerCase()?f+=' class="'+b[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+b[g]+'"'));var h="";for(var i in c)c[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+c[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>","undefined"==typeof objIdArr&&(objIdArr=[]),objIdArr[objIdArr.length]=b.id}else{var j=document.createElement("object");j.setAttribute("type","application/x-shockwave-flash");for(var k in b)b[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",b[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,b[k]));for(var l in c)c[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&a(j,l,c[l]);e.parentNode.replaceChild(j,e)}},c=function(a,c,d,e,f,g,h,i,j,k){d+="",e+="";var l={};if(j&&"object"==typeof j)for(var m in j)l[m]=j[m];l.data=a,l.width=d,l.height=e;var n={};if(i&&"object"==typeof i)for(var o in i)n[o]=i[o];if(h&&"object"==typeof h)for(var p in h)"undefined"!=typeof n.flashvars?n.flashvars+="&"+p+"="+h[p]:n.flashvars=p+"="+h[p];b(l,n,c)};return function(a,b,d,e,f){f=f||{};var g={};g.quality="high",g.bgcolor="#808080",g.allowscriptaccess="always",g.allowfullscreen="true";var h={};h.id=a,h.name=a,AV.msie&&AV.msie<9&&(h.align="center"),c(b,a+"_replace",d||"100%",e||"100%","10.0.32","",f,g,h)}}(),d=function(){};d.prototype=function(){return{getPlugins:function(){return[]},createCanvas:function(){this.initsize?c(a,AV.build.feather_baseURL+"canvas.swf",this.initsize.width,this.initsize.height):c(a,AV.build.feather_baseURL+"canvas.swf")},_onComponentLoaded:function(b){switch(b){case"canvas":var c=document.getElementById(a);AV.FlashAPI._onCanvasLoaded(c);break;case"controls":}},_onComponentReady:function(a){var b=AV.paintWidgetInstance;"canvas"===a&&b.canvasReadyCallback&&b.canvasReadyCallback.resolve()}}}();var e=function(){var a=[],b=function(){for(var b=0;b<256;b++)a[b]=String.fromCharCode(b);a[0]=String.fromCharCode(1)+String.fromCharCode(1),a[1]=String.fromCharCode(1)+String.fromCharCode(2)},c=function(b){for(var c="",d=0;d<b.length;d+=4)c+=a[b[d+3]],c+=a[b[d]],c+=a[b[d+1]],c+=a[b[d+2]];return c},d=function(a,b,c){for(var d,e=[],f=0,g=0,h=[0,0,1];g<a.length;)e[f++]=1!=(d=a.charCodeAt(g++))?d:h[a.charCodeAt(g++)];return e},e={};return e.init=b,e.shutdown=function(){a=[]},e.decode=d,e.encode=c,e}();return function(){var a=!1,c=!1;return{mapToFlashToolName:function(a){switch(a){case"rotate":return"rotate90"}return a},mapFromFlashToolName:function(a){switch(a){case"rotate90":return"rotate"}return a},customBridge:function(a){var b=function(){};b.prototype=new d,b.prototype.constructor=d;for(var c in a)b.prototype[c]=a[c];return b},activate:function(a){this.bridge=a||new d,this.goldenEggCallback=null},setHiresSize:function(a,b){this.canvas&&this.canvas.setHiresSize(a,b)},hiresSizeChanged:function(a,b){AV.paintWidgetInstance&&AV.paintWidgetInstance.actions&&AV.paintWidgetInstance.actions.setDims(a,b)},startEditing:function(a){this.canvas=null,this.active_target=a,this.bridge.createCanvas()},restartEditing:function(a){this.active_target=a,this._setupEditing()},close:function(){},runGoldenEgg:function(a,b,c,d){this.goldenEggCallback=d,this.canvas.renderGoldenEgg(a,b,c)},doCrop:function(){this.canvas.executeCrop()},activatePlugin:function(a){this.canvas.activatePlugin(a)},deactivatePlugin:function(a){this.canvas.deactivatePlugin(a)},changeProperty:function(a,b){this.canvas.changeProperty(a,b)},applyPreviewFromPlugin:function(a){this.canvas.applyPreviewFromPlugin(a)},commitChangesFromPlugin:function(a){this.canvas.commitChangesFromPlugin(a)},discardChangesFromPlugin:function(a){this.canvas.discardChangesFromPlugin(a)},resizeCanvas:function(a,b){var c=this.canvas;c.width=a+"px",c.height=b+"px",AV.paintWidgetInstance&&AV.paintWidgetInstance.setDimensions(a,b)},hideCanvas:function(){this.canvas&&(this.canvas.style.visibility="hidden")},showCanvas:function(){this.canvas&&(this.canvas.style.visibility="visible")},executePlugin:function(){this.canvas.executePlugin()},renderPreview:function(a,b){this.canvas.renderPreview(a,b)},getDynamicPropertyDefaultValue:function(a){return this.canvas.getDynamicPropertyDefaultValue(a)},syncProperty:function(a,b){},syncPreview:function(a){},setCanvasDataArray:function(a,b,c){AV.canvasDataReceiver&&AV.canvasDataReceiver.apply(this,[a,b,c])},setThumb:function(a,b){},getHistory:function(){return this.canvas.getHistory()},getHiResStickerUrl:function(a){return AV.paintWidgetInstance&&AV.paintWidgetInstance.overlayRegistry?AV.paintWidgetInstance.overlayRegistry.getHiRes(a):null},getImageData:function(a,c){c&&"function"==typeof c&&(b=c),this.canvas.commit({})},getMaxSize:function(){var a=AV.launchData.maxEditSize||AV.launchData.maxSize;return a},getMaxBitmapSize:function(){return AV.launchData.maxSize},_cropSelectionStarted:function(a,b,c){},_onPreviewRendered:function(a,b){},_onPluginLoaded:function(a,b){var c=AV.paintWidgetInstance;c.moduleLoadedCallback&&c.moduleLoadedCallback[a]&&c.moduleLoadedCallback[a].resolve()},_onImageLoaded:function(a,b){AV.paintWidgetLauncher_Flash_stage2&&AV.paintWidgetLauncher_Flash_stage2(a,b)},_onGoldenEggComplete:function(){this.goldenEggCallback&&this.goldenEggCallback()},_onCanvasLoaded:function(a){this.canvas=a,this._setupEditing(AV.launchData.url||null)},_onGetImageDataComplete:function(a){b&&(b.apply(this,[a]),b=null)},_setupEditing:function(a){var b=this.bridge.getPlugins();a=a||this.active_target.src,this.canvas.setup(a,AV.build.proxyServer,b)},_canUndo:function(){return a},_onUndo:function(){this.canvas.undo()},_canRedo:function(){return c},_onRedo:function(){this.canvas.redo()},_onHistoryChange:function(b,d){a=b,c=d,AV.controlsWidgetInstance&&AV.controlsWidgetInstance.layoutNotify(AV.launchData.openType,"updateUndoRedo",[b,d])},setCheckpoint:function(a){this.canvas.setCheckpoint(a)},isACheckpoint:function(a){return this.canvas.isACheckpoint(a)},undoToCheckpoint:function(){this.canvas.undoToCheckpoint()},redoToCheckpoint:function(){return this.canvas.redoToCheckpoint()},truncateActionList:function(){this.canvas.truncateActionList()},_onError:function(a,b){"BAD_IMAGE"===a&&(AV.paintWidgetCloser(!0),AV.launchData.url&&(a="BAD_URL")),AV.errorNotify(a,b)},init:function(a){function b(){if(!a)return new d;if(a.plugins){for(var b=[],c=a.plugins,e=0;e<c.length;++e){var f=AV.FlashAPI.mapToFlashToolName(c[e]),g=AV.toolDefaults[c[e]];g&&g.files&&b.push({id:f,presets:g.presetsFlash,files:g.files})}b.length>0&&(a.getPlugins=function(){return b}),delete a.plugins}var h=function(){};h.prototype=new d,h.prototype.constructor=d;for(var i in a)h.prototype[i]=a[i];return new h}AV.FlashAPI.activate(b()),e.init()},pibeca:e}}()}(),function(a,b,c){a.AV=a.AV||{};var d=a.AV;return d.ImageSizeTracker=function(a){var b=this;b.setImageScaledIndicator=function(){d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"updateImageScaledIndicator")},b.setOrigSize=function(a,c,e){var f,g;if(a.hiresWidth&&a.hiresHeight)f=parseInt(a.hiresWidth,10),g=parseInt(a.hiresHeight,10);else if(a.hiresUrl)f=c.width,g=c.height;else{if(!a.displayImageSize)return null;f=e.width,g=e.height}return d.paintWidgetInstance.actions.setOrigSize(f,g),b.setImageScaledIndicator(),{width:f,height:g}},b.isDisplayingImageSize=function(a){return a.hiresWidth||a.hiresHeight||a.displayImageSize},b.isUsingHiResDimensions=function(a){return a.hiresWidth||a.hiresHeight||a.displayImageSize&&a.hiresUrl}},a}(this,"undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{}),function(a,b,c){a.AV=a.AV||{};var d=a.AV,e=d.Events;return d.ToolManager=function(a){var f=null,g=function(b){var c,e,f=a.activeTools,g=!1;if(f)for(e=f.length,c=0;c<e;c++)if(f[c]===b){g=!0;break}return g||d.errorNotify("UNSUPPORTED_TOOL",[b]),g},h=function(b,c,d){return a.objectNotify("tool",b,c,d)},i=function(a){null!=a&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+a).show())},j=function(){var c,g=function(g){h(f,"panelWillClose"),h(g,"panelWillOpen"),e.trigger("canvas:activate",a.panelMode2WidgetMode(g)),i(g),h(g,"resetUI"),b.setTimeout(function(a){return function(){h(a,"panelDidClose"),f=g,h(g,"panelDidOpen"),c=!1}}(f),200),f=g,a.layoutNotify(d.launchData.openType,"disableZoomMode")};return function(a){c||(c=!0,g(a))}}(),k=function(b){if(!a.paintWidget||!a.paintWidget.busy){if(a.layoutNotify(d.launchData.openType,"showView",["editpanel"]),j(b),d.controlsWidgetInstance.onEggWaitThrobber.stop(),"mobile"==d.launchData.openType){var e,f=c.getElementById("avpw_main_"+b);f&&(e=f.getAttribute("data-header"),e&&(c.getElementById("avpw_control_toolname").innerHTML=e))}d.usageTracker.addUsage(b)}},l=function(){e.on("tool:open",o),e.on("tool:close",n),e.on("tool:init",p),e.on("tool:shutdown",s),e.on("tool:commit",q),e.on("tool:cancel",r),e.on("tool:undo",x),e.on("tool:redo",y)},m=function(){e.off("tool:open",o),e.off("tool:close",n),e.off("tool:init",p),e.off("tool:shutdown",s),e.off("tool:commit",q),e.off("tool:cancel",r),e.off("tool:undo",x),e.off("tool:redo",y)},n=function(){a.layoutNotify(d.launchData.openType,"showView",["main"]),j(null)},o=function(b,c){b=d.publicName2PanelMode(b),g(b)&&a.paintWidget&&!a.paintWidget.moduleLoaded(b,k)&&c&&(a.onEggWaitThrobber.stop(),a.onEggWaitThrobber.spin(avpw$(c).children(".avpw_icon_waiter")[0])),e.trigger("usage:tool",b,"opened"),e.trigger("usage:firstclick",b)},p=function(b){h(b,"init",[a])},q=function(){var a,b=f;b&&(a=h(f,"commit"),a!==!1&&(e.trigger("usage:tool",b,"applied",a!==!0?a:""),e.trigger("tool:commitDone")))},r=function(){h(f,"cancel"),e.trigger("usage:tool",f,"canceled")},s=function(a){h(a,"shutdown")},t=function(){return!a.paintWidget.busy&&(h(f,"onUndo")!==!1&&(a.paintWidget.actions.undo(),h(f,"onUndoComplete"),!1))},u=function(){return!a.paintWidget.busy&&(h(f,"onUndo",[{global:!0}])!==!1&&(a.paintWidget.actions.undoToCheckpoint(),h(f,"onUndoComplete",[{global:!0}]),!1))},v=function(){return!a.paintWidget.busy&&(h(f,"onRedo")!==!1&&(a.paintWidget.actions.redo(),h(f,"onRedoComplete"),!1))},w=function(){if(a.paintWidget.busy)return!1;if(h(f,"onRedo",[{global:!0}])===!1)return!1;var b=a.paintWidget.actions.redoToCheckpoint();return b&&h(f,"onRedoComplete",[{global:!0}]),b},x=function(){e.trigger("usage:tool","undo","applied",f||""),a.paintWidget.actions.isACheckpoint()?u():t()},y=function(){e.trigger("usage:tool","redo","applied",f||""),w()||v()},z=this;return z.init=l,z.shutdown=m,z.notify=h,z.getActiveTool=function(){return f},l(),z},a}(this,"undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{}),function(a,b,c){a.AssetManager=function(c,d){"use strict";var e,f={EFFECT:"effect",STICKER:"sticker",IMAGEBORDER:"imageborder",PERMISSION:"permission"},g={},h=function(){b.avpw_purchase_frame||avpw$("#avpw_messaging").append(a.template[a.launchData.layout].inAppPurchaseFrame({src:a.build.inAppPurchaseFrameURL}))},i=function(b){var c=b.resourceUrl;c&&(c.indexOf("http")===-1&&(c=a.build.feather_baseURL+c),b.resourceUrl=c)},j=function(b){for(var c=0;c<e.length;c++)for(var d=0;d<b.length;d++)b[d].assetId===e[c].assetId&&(e[c].purchased=!0,a.util.extend(e[c],b[d]),i(e[c]))},k=function(a){var b=[];if(a){a=f[a];for(var c=0;c<e.length;c++)e[c].assetType===a&&b.push(e[c])}else b=e.slice(0);return b},l=function(b,c){e?c&&c.apply(this,[k(b)]):(g.getPartnerAssets||(g.getPartnerAssets=[],r.authenticate()),g.getPartnerAssets.push(function(d){d&&d.assets?e=d.assets:(a.errorNotify("ERROR_AUTHENTICATING"),o()),a.util.nextFrame(function(){if(e){for(var a=0;a<e.length;a++)i(e[a]);c&&c.apply(this,[k(b)])}})}))},m=function(a,c){b.setTimeout(function(){try{return b.avpw_purchase_frame.postMessage("getAssets","*"),g.getAssets=c,!0}catch(a){return!1}},2e3)},n=function(a,c){if(!e)return m(a,function(b){e=b;for(var d=0;d<e.length;d++)i(e[d]);q(a,c)}),!1;try{return b.avpw_purchase_frame.postMessage("getPurchasedAssets","*"),g.getPurchasedAssets=function(b){j(b),c&&c.apply(this,[k(a)])},!0}catch(a){return!1}},o=function(b,c){return e=[{needsPurchase:!1,assetId:"default_effects",assetType:"effect",displayName:"Default",resourceUrl:"js/proclist_default_effects.js"},{needsPurchase:!1,assetId:"original_effects",assetType:"effect",displayName:"Original",resourceUrl:"js/proclist_original_effects.js"},{needsPurchase:!1,assetId:"original_stickers",assetType:"sticker",displayName:"Original",resourceUrl:"js/stickers_original_stickers.js"},{needsPurchase:!1,assetId:"borders",assetType:"imageborder",displayName:"Default Image Borders",resourceUrl:"js/borders_original.js"}],c&&a.util.nextFrame(function(){for(var a=0;a<e.length;a++)i(e[a]);c.apply(this,[k(b)])}),!0},p=function(a){var b,c,d;if(a.messageName&&(d=g[a.messageName])){if("function"==typeof d)d.apply(this,[a.data]);else for(c=d.length,b=0;b<c;b++)d[b].apply(this,[a.data]);d=null}},q=c?l:d?n:o,r=this;return r.getAssets=q,r.getById=function(a){for(var b=0;b<e.length;b++)if(e[b].assetId===a)return e[b]},r.showAssetPurchaseView=function(c,d){var e={messageName:"showAssetPurchaseView",assetId:c};e=a.JSON.stringify(e);try{return b.avpw_purchase_frame.postMessage(e,"*"),g.showAssetPurchaseView=function(){r.showAssetPurchasePopup(c,d)},!0}catch(a){return!1}},r.showAssetPurchasePopup=function(b,c){avpw$("#avpw_purchase_frame").show(),a.controlsWidgetInstance.messager.show("avpw_purchase_pack",!0),avpw$("#avpw_purchase_pack_close").bind("click",r.hideAssetPurchasePopup),g.getPurchasedAssets=function(a){j(a);var d=r.getById(b);c&&"function"==typeof c&&d&&c.apply(this,[d]),r.hideAssetPurchasePopup()}},r.hideAssetPurchasePopup=function(){g.getPurchasedAssets=null,avpw$("#avpw_purchase_frame").hide(),a.controlsWidgetInstance.messager.hide("avpw_purchase_pack"),avpw$("#avpw_purchase_pack_close").unbind("click",r.hideAssetPurchasePopup)},r.authenticate=function(){var b=function(a){var b={messageName:"getPartnerAssets",data:a};p(b)};return function(){return a.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_auth_form",action:a.build.partnerAssetURL,method:"POST",dataType:"json",announcer:a.build.asyncFeatherTargetAnnounce,origin:a.build.asyncImgrecvBase,keyValues:{apikey:a.launchData.apiKey,timestamp:a.launchData.timestamp,signature:a.launchData.signature,salt:a.launchData.salt,encryptionmethod:a.launchData.encryptionMethod},callback:b})}}(),r.types=f,d&&h(),r}}(window.AV||(window.AV={}),window,document),function(a,b,c){a.ServerMessaging=function(d){var e=[],f=function(b,c){var d,f,g=!0,h=e.shift();if(h&&(c&&h.origin&&(g=c===a.util.getDomain(h.origin)),h.id&&(d=avpw$("#"+h.id),f=d.attr("target"),avpw$("#"+f).unbind("load"),avpw$("#"+h.id+"_target_holder").empty(),d.remove()),g&&h.callback)){if(h.dataType&&"json"===h.dataType&&"string"==typeof b)try{b=a.JSON.parse(b)}catch(a){}h.callback.call(this,b)}e.length>0&&n()},g=function(b,c,d,e,f){return avpw$.ajax({url:b,type:c,data:d,dataType:e,error:function(){a.errorNotify("ERROR_SAVING",[a.build.imgrecvServer])},success:f})},h=function(a,b,d,e,f){var g=avpw$("<form></form>").attr({id:a,action:b,target:d,method:e||"POST"}).css({display:"none"}),h=c.createDocumentFragment();for(var i in f)f.hasOwnProperty(i)&&h.appendChild(avpw$("<input></input>").attr({name:i,value:f[i],type:"hidden"})[0]);return g.html(h),g.appendTo("#avpw_holder"),g},i=function(b,c,d){return d||(d=a.build.feather_baseURL+"blank.html"),c||(c=b),['<iframe width="1" height="1" ','style="position:absolute;left:-9999px;" ','id="'+b+'" name="'+c+'" src="'+d+'">',"</iframe>"].join("")},j=function(a,b,c){if(!a)return null;var d=a+"_target_holder",e=Math.floor(4294967295*Math.random()).toString(16),f="avpw_form_target_"+e,g=avpw$("#"+d);return g&&g.length||(g=avpw$('<div id="'+d+'"></div>').css({position:"absolute",top:0,left:0}).appendTo("#avpw_holder")),g.html(i(f)),b?avpw$("#"+f).load(function(){l(f,a,b)}):avpw$("#"+f).load(c),f},k=function(a,b,c,d,e,f,g){var i=j(a,f,g);b+="?responsecontenttypeheader="+escape("text/html");var k=h(a,b,i,c,e);return k.submit(),k},l=function(c,d,e){var g,h=d+"_announcer";if(b.postMessage)b[h]?b[h].postMessage("avpw_load:"+c,"*"):(g=avpw$(i(h,h,e)),g.load(function(){a.util.nextFrame(function(){b[h].postMessage("avpw_load:"+c,"*")})}),avpw$("#avpw_holder").append(g));else{var j,k=function(){avpw$(j).unbind().remove()},l=d+"_observer",m=l,n=0,o=function(){var b;try{if("about:blank"==j.contentWindow.location)return}catch(a){}2===n&&(b=j.contentWindow.name,b&&(n=3,b!==m&&b.substr&&"avpw:"==b.substr(0,5)?(b=b.substr(5),f(b)):(a.errorNotify("ERROR_SAVING",[a.build.imgrecvServer]),f()),k())),1===n&&(n=2,j.contentWindow.location=""),n||(n=1)};j=avpw$(i(l,m,e+"#"+c))[0],avpw$(j).load(o),avpw$(j).appendTo("#avpw_holder")}},m=function(b){var c=b.data,d=a.util.getDomain(b.origin);c.substr&&"avpw:"==c.substr(0,5)&&(c=c.substr(5),f(c,d))},n=function(){var a=e[0];a&&k(a.id,a.action,a.method,a.origin,a.keyValues,a.announcer)},o=function(a){a.announcer?(e.push(a),1===e.length&&n()):k(a.id,a.action,a.method,a.origin,a.keyValues,a.announcer,a.callback)},p=function(b){var c,d=b.transport||"xhr";"xhr"===d&&avpw$.support.cors&&(!a.firefox||a.firefox>=4)?(c=g(b.action,b.method,b.keyValues,b.dataType,b.callback),c||o(b)):o(b)},q=function(){b.addEventListener?b.addEventListener("message",m,!1):b.attachEvent&&b.attachEvent("onmessage",m)},r=this;return r.shutdown=function(){b.removeEventListener?b.removeEventListener("message",m,!1):b.detachEvent&&b.detachEvent("onmessage",m),e=[]},r.sendMessage=p,q(),r}}(window.AV||(window.AV={}),window,document),function(a,b,c){a.AV=a.AV||{};var d=a.AV,e=d.Events;return d.usageTracker=function(){var a,f=null,g={},h=0,i=[],j=0,k=-1,l=1,m=!1,n={},o=function(){d.controlsWidgetInstance&&n.submit("close")},p=function(){if(b._gaq=b._gaq||[],"undefined"==typeof _gat){var a=c.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==c.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=c.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}m||(_gaq.push(["Feather._setAccount",d.build.googleTracker]),_gaq.push(["Feather._setCustomVar",1,"apikey",d.launchData.apiKey]),_gaq.push(["Feather._setCustomVar",2,"featherversion",d.build.version]),_gaq.push(["Feather._setCustomVar",3,"sessionid",this.getUUID()]),_gaq.push(["Feather._setCustomVar",4,"language",d.launchData.language]),_gaq.push(["Feather._setCustomVar",5,"apiversion",d.launchData.apiVersion+""]),m=!0)},q=function(a,b,c){_gaq.push(["Feather._trackEvent","tool",a+":"+b,c?c+"":""])},r=function(a,b,c){_gaq.push(["Feather._trackEvent","interaction",a+":"+b,c?c+"":""])},s=function(a){n.submit("firstclick",a),e.off("usage:firstclick")};return n.setup=function(){avpw$(b).bind("unload",o),e.on("usage:submit",n.submit,n),e.on("usage:tool",q,n),e.on("usage:firstclick",s,n),e.on("usage:interact",r)},n.shutdown=function(){avpw$(b).unbind("unload",o),e.off("usage:submit",n.submit),e.off("usage:tool",q),e.off("usage:firstclick",s),e.off("usage:interact",r)},n.clear=function(){f=null,g={},h=0,i=[],j=0,k=-1},n.getUUID=function(){return f?f:f=Math.floor(4294967295*Math.random()).toString(16)+Math.floor(4294967295*Math.random()).toString(16)},n.addUsage=function(a,b){b||(b=1),void 0===g[a]?g[a]=b:g[a]+=b,h+=b},n.setPageCount=function(a){var b;for(j=a,i=new Array(a),b=0;b<a;b++)i[b]=0},n.addPageHit=function(b){b!==a&&i[b]++,a=b},n.submit=function(a,b){var c,e=null,f="";if(p.call(this),"launch"===a?_gaq.push(["Feather._trackPageview"]):_gaq.push(["Feather._trackEvent","submit",a,b]),d.controlsWidgetInstance&&d.build.imgtrackServer&&d.JSON){switch(a){case"close":e={dataver:l,opentype:d.launchData.openType,pagehits:i,toolusage:g},f=d.JSON.stringify(e);break;case"firstclick":e={toolusage:g},f=d.JSON.stringify(e)}c=d.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_track_form",action:d.build.imgtrackServer,method:"GET",keyValues:{action:a,sessionid:this.getUUID(),featherversion:d.build.version,apikey:d.launchData.apiKey,toolusagedata:f},callback:function(){d.util.nextFrame(function(){var a=avpw$("#avpw_track_form_target_holder");if(a&&a.length&&a.empty(),c){var b=c.attr("target");avpw$("#"+b).unbind("load"),c.remove()}})},transport:"form"})}},n}(),d.getActiveTools=function(a){var b=d.featherUseFlash?d.flashSupportedTools:d.defaultTools,c=a;c&&"all"!==c&&"All"!==c&&"ALL"!==c&&""!==c||(c=b),"string"==typeof c&&(c=a.split(","));var e,f,g=[],h={};for(f=0;f<b.length;f++)e=b[f],h[e]=!0;for(f=0;f<c.length;f++)e=d.publicName2PanelMode(c[f]),e in h&&g.push(e);return g},d.paintWidgetGetPopupEmbedDiv=function(a){var b=avpw$("#avpw_canvas_embed_popup");if(a){var d,e,f,g=avpw$(a),h=["top","left","bottom","right","margin-top","margin-right","margin-bottom","margin-left","border-top","border-right","border-bottom","border-left","padding-top","padding-right","padding-bottom","padding-left"],i={position:"relative"};for(e=0;e<h.length;e++)f=h[e],i[f]=g.css(f);d=avpw$(a).css("display"),""!=d&&"inline"!=d||(d="inline-block"),i.display=d,0==b.length&&(b=c.createElement("div"),b.id="avpw_canvas_embed_popup"),avpw$(b).hide().css(i).insertBefore(a)}return b},d.paintWidgetLauncher=function(a,b){if(!d.paintWidgetInstance)return d.usageTracker.clear(),d.featherUseFlash?d.paintWidgetLauncher_Flash(a,b):d.paintWidgetLauncher_HTML(a,b)},d.paintWidgetLauncher_Flash=function(a,f){function g(){avpw$(i).unbind("load",g),d.msie&&7==d.msie&&(avpw$("#avpw_controls").css("visibility","hidden"),avpw$("#avpw_controls").show()),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"placeControls_Flash",[2===d.util.getApiVersion(d.launchData)?d.launchData.appendTo:void 0]),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"enableControls"),k=d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getScaledImageDims_Flash",[i]),l=k.width,m=k.height,n=l>m?l:m,d.launchData.maxEditSize=n,d.paintWidgetInstance=new d.PaintWidget(l,m,new d.Actions,new d.ModeManager,new d.FilterManager,new d.OverlayRegistry,new d.ImageBorderManager),d.paintWidgetInstance.setOrigSize(l,m);var c=d.template[d.launchData.layout].flashCanvasBox({id:"avpw_canvas_swf_replace"});avpw$(j).append(c),d.controlsWidgetInstance.initAllTools.call(d.controlsWidgetInstance);var h={initsize:k,plugins:p,action:{origUrl_:f?f:s.src,sessionID_:d.usageTracker.getUUID(),referrerUrl_:b.location.href,url:d.build.imgrecvServer,name:"file"}};d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"hideOriginalImage",[s]),d.util.nextFrame(function(){d.controlsWidgetInstance.setupScrollPanels()}),d.msie&&7==d.msie&&(avpw$("#avpw_controls").hide(),avpw$("#avpw_controls").css("visibility","visible")),avpw$("#avpw_controls").fadeIn(r),d.launchData.noCloseButton&&avpw$("#avpw_control_cancel_pane").css("display","none");setTimeout(function(){d.FlashAPI.init(h),d.FlashAPI.startEditing(a),d.controlsWidgetInstance.initWithPaintWidget(d.paintWidgetInstance),e.trigger("tool:close"),d.controlsWidgetInstance.loaderPhase=1},r)}function h(){d.util.imgOnLoad(i,g),avpw$(i).attr("src",f?f:t)}var i,j,k,l,m,n,o,p,q,r=d.launchData.launchDelay,s=d.util.getImageElem(a),t=s.src;p=d.getActiveTools(d.launchData.tools),q=new d.AssetManager(d.launchData.isPremiumPartner,d.launchData.allowInAppPurchase),d.controlsWidgetInstance=new d.ControlsWidget(null,a,p,q,new d.ServerMessaging),f?d.controlsWidgetInstance.origURL=f:d.controlsWidgetInstance.origURL=avpw$(s).attr("src"),avpw$(".avpw_isa_previewcanvas").hide(),j=d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getEmbedElement",[s]),avpw$(j).show(),o="js/featherpaint_flash.js",i=c.createElement("img"),avpw$(i).css({display:"block",visibility:"hidden",position:"absolute"}).attr("src",f?f:s.src),d.build.bundled?h():d.util.loadFile(d.build.feather_baseURL+o,"js",h)},d.paintWidgetLauncher_Flash_stage2=function(a,b){d.controlsWidgetInstance.loaderPhase=2,d.controlsWidgetInstance.imageSizeTracker.setOrigSize(d.launchData,{width:a,height:b},{width:d.paintWidgetInstance.width,height:d.paintWidgetInstance.height}),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"launchStage2_Flash"),d.controlsWidgetInstance.showWaitThrobber(!1),avpw$(d.controlsWidgetInstance.onEggWaitThrobber).hide(),e.trigger("usage:submit","launch"),d.fireLaunchComplete()},d.paintWidgetLauncher_HTML=function(a,b){
var e,f,g,h,i,j,k=d.launchData.launchDelay,l=d.util.getImageElem(a);return i=d.getActiveTools(d.launchData.tools),d.isRelaunched&&"undefined"!=typeof l.avpw_prevURL&&(b=l.avpw_prevURL),j=new d.AssetManager(d.launchData.isPremiumPartner,d.launchData.allowInAppPurchase),d.controlsWidgetInstance=new d.ControlsWidget(null,a,i,j,new d.ServerMessaging),b?d.controlsWidgetInstance.origURL=b:d.controlsWidgetInstance.origURL=avpw$(l).attr("src"),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"placeControls",[2===d.util.getApiVersion(d.launchData)?d.launchData.appendTo:void 0]),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"enableControls"),avpw$("#avpw_controls").fadeIn(k),d.util.nextFrame(function(){"mobile"==d.launchData.openType&&d.setPageWidth(avpw$("#avpw_controls").width()),d.controlsWidgetInstance.setupScrollPanels()}),d.launchData.noCloseButton&&avpw$("#avpw_control_cancel_pane").css("display","none"),l&&"canvas"===l.nodeName.toLowerCase()?void d.mockLauncher(l):(g="js/featherpaint.js",f=d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getEmbedElement",[l]),e=c.createElement("img"),e.id="avpw_temp_loading_image",d.tempLoadingImageSrc=e.src,avpw$(e).load(function(){h=d.controlsWidgetInstance.getScaledDims(avpw$(l).width(),avpw$(l).height()),e.width=h.width,e.height=h.height,d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getScaledImageDims",[e]),avpw$(e).unbind(),e.style.display="block",avpw$(f).append(e),d.controlsWidgetInstance.showWaitThrobber(!0),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"hideOriginalImage",[l]),avpw$(f).show(),d.util.nextFrame(function(){d.build.bundled?d.paintWidgetLauncher_stage2(a,b):d.util.loadFile(d.build.feather_baseURL+g,"js",function(c){d.paintWidgetLauncher_stage2(a,b)})})}).error(function(){d.paintWidgetCloser(!0),d.errorNotify("BAD_IMAGE",[b])}),e.src=l.src,!1)},d.mockLauncher=function(a){var b=d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getEmbedElement",[a]);d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getScaledImageDims",[a]),avpw$(a).detach(),avpw$(b).append(a),avpw$(b).show(),d.controlsWidgetInstance.showWaitThrobber(!0),d.util.nextFrame(function(){var a=function(){};d.controlsWidgetInstance.initAllTools=function(){for(var a in this.activeTools){var b=this.activeTools[a];this.tool.hasOwnProperty(b)&&e.trigger("tool:init",b)}},d.controlsWidgetInstance.initWithPaintWidget=function(a){this.paintWidget=a,this.initAllTools(),this.bindControls(),this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)},d.controlsWidgetInstance.loaderPhase=1,d.paintWidgetInstance={moduleLoaded:function(a,b){return b.call(this)},setMode:a,setCurrentLayerByName:a,shutdown:a,actions:{setCheckpoint:a}},d.controlsWidgetInstance.initWithPaintWidget(d.paintWidgetInstance),d.controlsWidgetInstance.showWaitThrobber(!1),d.controlsWidgetInstance.loaderPhase=2,d.fireLaunchComplete()})},d.paintWidgetLauncher_stage2=function(a,b){var c,f,g=d.util.getImageElem(a),h=function(a){d.controlsWidgetInstance&&d.paintWidgetInstance&&(c=new Image,avpw$(c).load(function(a){if(d.controlsWidgetInstance&&d.paintWidgetInstance){if(f=d.controlsWidgetInstance.getScaledDims(c.width,c.height),d.controlsWidgetInstance.imageSizeTracker.setOrigSize(d.launchData,c,f),c.width=f.width,c.height=f.height,d.paintWidgetInstance.setDimensions(f.width,f.height),!d.paintWidgetInstance.setBackground(c))return d.paintWidgetCloser(!0),d.errorNotify("IMAGE_NOT_CLEAN",[b]),!1;d.paintWidgetInstance.setOrigSize(f.width,f.height),g.src!==b&&d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"scaleCanvas"),avpw$(d.paintWidgetInstance.canvas).insertBefore("#avpw_temp_loading_image"),i.remove(),d.tempLoadingImageSrc=b,d.controlsWidgetInstance.showWaitThrobber(!1),d.controlsWidgetInstance.loaderPhase=2,d.launchData.actionListJSON&&d.paintWidgetInstance.actions.importJSON(d.launchData.actionListJSON,d.fireLaunchComplete)}}).attr("src",a))};f=d.controlsWidgetInstance.getScaledDims(avpw$(g).width(),avpw$(g).height()),d.controlsWidgetInstance.loaderPhase=1,d.paintWidgetInstance=new d.PaintWidget(f.width,f.height,new d.Actions,new d.ModeManager,new d.FilterManager,new d.OverlayRegistry,new d.ImageBorderManager),d.controlsWidgetInstance.canvasUI=new d.PaintUI(d.paintWidgetInstance.canvas,d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"getEmbedElement")),d.controlsWidgetInstance.initWithPaintWidget(d.paintWidgetInstance),d.paintWidgetInstance.setOrigSize(f.width,f.height),d.controlsWidgetInstance.imageSizeTracker.setOrigSize(d.launchData,g,f);var i=avpw$("#avpw_temp_loading_image");if(d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"scaleCanvas"),null!=b)b.indexOf("data:")===-1?avpw$.ajax({type:"GET",dataType:"json",url:d.build.jsonp_imgserver+"?callback=?",data:{url:escape(b)},success:function(a){h(a.data)},error:function(a,c,e){200===a.status&&"parsererror"===c&&d.controlsWidgetInstance&&(d.controlsWidgetInstance.showWaitThrobber(!1),d.util.nextFrame(function(){d.paintWidgetCloser(!0),d.errorNotify("BAD_URL",[b])}))}}):h(b);else{if(!d.paintWidgetInstance.setBackground(g))return d.paintWidgetCloser(!0),d.errorNotify("IMAGE_NOT_CLEAN",[b]),!1;avpw$("#avpw_controls").insertAfter(d.paintWidgetInstance.canvas),avpw$(d.paintWidgetInstance.canvas).insertBefore(i),i.remove(),d.tempLoadingImageSrc=g.src,d.controlsWidgetInstance.showWaitThrobber(!1),d.controlsWidgetInstance.loaderPhase=2,d.launchData.actionListJSON&&d.paintWidgetInstance.actions.importJSON(d.launchData.actionListJSON,d.fireLaunchComplete)}return e.trigger("usage:submit","launch"),d.launchData.actionListJSON||d.fireLaunchComplete(),!1},d.fireLaunchComplete=function(){var a=d.launchData.initTool;a&&d.util.nextFrame(function(){e.trigger("tool:open",a)}),"function"==typeof d.launchData.onReady&&d.launchData.onReady()},d.paintWidgetShutdown=function(){e.trigger("usage:submit","close"),d.paintWidgetInstance&&d.paintWidgetInstance.shutdown(),d.controlsWidgetInstance&&(d.controlsWidgetInstance.serverMessaging&&(d.controlsWidgetInstance.serverMessaging.shutdown(),d.controlsWidgetInstance.serverMessaging=null),d.controlsWidgetInstance.shutdown()),d.featherUseFlash&&d.FlashAPI.close(),avpw$("#avpw_controls").hide(),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"onShutdown"),"function"==typeof d.launchData.onClose&&d.launchData.onClose(d.paintWidgetInstance.dirty),d.paintWidgetInstance=null,d.controlsWidgetInstance=null,d.tempLoadingImageSrc=null},d.paintWidgetCloser=function(a){var b=d.launchData.closeDelay;d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"onClose",[a]),a||0===b?(avpw$("#avpw_controls").hide(),d.paintWidgetShutdown()):avpw$("#avpw_controls").fadeOut(b,function(){d.paintWidgetInstance&&d.paintWidgetShutdown()})},d.controlsWidget_saveResponder=function(a,b,c){var f;if("function"==typeof a&&(f=a.apply(d.launchData,[d.util.getImageId(d.controlsWidgetInstance.paintImgIdElem),b,c])),d.controlsWidgetInstance){var g=d.util.getImageElem(d.controlsWidgetInstance.paintImgIdElem);g.avpw_prevURL=b,e.trigger("tool:close"),f!==!1&&d.controlsWidgetInstance.messager.show("avpw_aviary_beensaved",!0),d.controlsWidgetInstance.paintWidget.dirty=!1,d.controlsWidgetInstance.saving=!1}},d.controlsWidget_onImageSaved=function(a,b){d.controlsWidget_saveResponder(d.launchData.onSave,a,b)},d.controlsWidget_onHiResImageSaved=function(a){d.controlsWidget_saveResponder(d.launchData.onSaveHiRes,a)},d.ControlsWidget=function(a,b,c,f,g){this.maxWidth=parseInt(d.launchData.maxSize),this.maxHeight=this.maxWidth,this.saving=!1,this.origURL=null,this.activeTools=c,this.quitCount=0,d.usageTracker.setup(),this.paintImgIdElem=b,e.on("layout:resize",this.setupScrollPanels,this),this.layoutNotify(d.launchData.openType,"showView",["main"]),a&&this.initWithPaintWidget(a);var h={className:"avpw_canvas_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70},i={className:"avpw_tool_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70};"mobile"!=d.launchData.openType&&(i.color="#555",i.length=4),this.waitThrobber=new d.Spinner(h),this.onEggWaitThrobber=new d.Spinner(i),this.toolManager=new d.ToolManager(this),this.assetManager=f,this.serverMessaging=g},d.ControlsWidget.prototype.tool={},d.ControlsWidget.prototype.layout={},d.ControlsWidget.prototype.layoutNotify=function(a,b,c){return this.objectNotify("layout",a,b,c)},d.ControlsWidget.prototype.objectNotify=function(a,b,c,d){if("object"==typeof this[a][b]){var e=this[a][b];if("function"==typeof e[c]){var f=e[c];return d||(d=[]),f.apply(e,d)}}return!0},d.ControlsWidget.prototype.shutdown=function(){this.canvasUI&&this.canvasUI.shutdown(),this.messager&&this.messager.hide(),e.off("layout:resize",this.setupScrollPanels),this.shutdownAllTools(),this.unbindControls(),this.toolsPager&&(this.toolsPager.shutdown(),this.toolsPager=null),this.paintWidget&&(this.paintWidget.showWaitThrobber=null),d.usageTracker.shutdown(),this.waitThrobber.stop(),this.onEggWaitThrobber.stop(),this.waitThrobber=null,this.onEggWaitThrobber=null,this.showPanel(null),this.toolManager.shutdown(),this.toolManager=null},d.ControlsWidget.prototype.initAllTools=function(){d.paintWidgetInstance.filterManager.loadPack("tools");for(var a in this.activeTools){var b=this.activeTools[a];this.tool.hasOwnProperty(b)&&d.paintWidgetInstance.moduleLoaded(b,function(a){e.trigger("tool:init",a)}.AV_bindInst(this))}},d.ControlsWidget.prototype.shutdownAllTools=function(){for(var a in this.activeTools){var b=this.activeTools[a];e.trigger("tool:shutdown",b)}},d.ControlsWidget.prototype.bindControls=function(){},d.ControlsWidget.prototype.unbindControls=function(){},d.ControlsWidget.prototype.initWithPaintWidget=function(a){this.paintWidget=a,this.imageSizeTracker=new d.ImageSizeTracker(a.actions),d.featherUseFlash||this.initAllTools(),this.bindControls(),this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)},d.ControlsWidget.prototype.showWaitThrobber=function(a,c){var e=300,f=this;if(a){var g=this.layoutNotify(d.launchData.openType,"getEmbedElement");g.is(":visible")&&(this.waitThrobber.spin(g[0]),avpw$(this.waitThrobber).fadeIn(e))}else avpw$(f.waitThrobber.el).fadeOut(e,f.waitThrobber.stop);c&&b.setTimeout(c,5)},d.publicName2PanelMode=function(a){return"stickers"===a&&(a="overlay"),"draw"===a&&(a="drawing"),"text"!==a||d.featherUseFlash||(a="textwithfont"),a},d.ControlsWidget.prototype.panelMode2WidgetMode=function(a){switch(a){case"rotate":return"rotate90";case"greeneye":return"redeye";case"pinch":return"bulge"}return a},d.ControlsWidget.prototype.setupScrollPanels=function(){if(this.activeTools&&this.activeTools.length){var a,b,c,e=this,f={},g=this.layoutNotify(d.launchData.openType,"getDims").TOOLS_BROWSER_WIDTH,h=function(){e.toolsPager=new d.Pager(i)},i={itemCount:this.activeTools.length,itemsPerPage:this.layoutNotify(d.launchData.openType,"getToolsPerPage"),pageWidth:g,leftArrow:avpw$("#avpw_lftArrow"),rightArrow:avpw$("#avpw_rghtArrow"),itemBuilder:function(c){return a=e.activeTools[c],b="overlay"==a?d.getLocalizedString("Stickers"):"barrel"==a?d.getLocalizedString("Bulge"):"drawing"==a?d.getLocalizedString("Draw"):"textwithfont"==a?d.getLocalizedString("Text"):"colorsplash"==a?d.getLocalizedString("Splash"):"tiltshift"==a?d.getLocalizedString("Tilt Shift"):a.substr(0,1).toUpperCase()+a.substr(1),b=d.getLocalizedString(b),d.template[d.launchData.layout].eggIcon({optionName:a,capOptionName:b})},pageTemplate:d.template[d.launchData.layout].genericScrollPanel,pipTemplate:d.template[d.launchData.layout].scrollPanelPip,lastPageTemplate:c,lastPageContents:f,pageContainer:avpw$("#avpw_control_main_scrolling_region"),pipContainer:avpw$("#avpw_tools_pager ul"),onPageChange:function(a){d.usageTracker.addPageHit(a)}};h(),avpw$("#avpw_control_main_scrolling_region").css("width",e.toolsPager.getPageCount()*g+"px"),this.assetManager.getAssets("PERMISSION",function(a){var b=!0;if(a)for(var c=0;c<a.length;c++)if(a[c]&&"whitelabel"===a[c].assetId){b=!1;break}b&&(i.lastPageTemplate=d.template[d.launchData.layout].aviaryScrollPanel,i.lastPageContents={panelWidth:g,panelClass:"avpw_scroll_page_complete"},avpw$("#avpw_powered_branding").html(d.template[d.launchData.layout].poweredByFooterLogo),e.toolsPager.shutdown(),h(),avpw$("#avpw_control_main_scrolling_region").css("width",e.toolsPager.getPageCount()*g+"px"),e.toolsPager.changePage())}),d.usageTracker.setPageCount(e.toolsPager.getPageCount()),e.toolsPager.changePage()}},d.ControlsWidget.prototype.messager=function(){var a,c,e,f={},g=1e3;return{show:function(e,h,i){a=a||avpw$("#avpw_messaging"),c=c||avpw$("#avpw_messaging_inner");var j=f[e]||(f[e]=avpw$("#"+e));c.append(j),a.show(),h?(a.data("needsConfirmation",!0),d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"disableControls")):(a.data("needsConfirmation",!1),i||b.setTimeout(this.hide,g))},hide:function(c,g){if(a=a||avpw$("#avpw_messaging"),e=e||avpw$("#avpw_messages"),c){var h=f[c];h&&e.append(h)}else avpw$.each(f,function(a,b){e.append(b)});a.data("needsConfirmation")?(b.setTimeout(function(){g&&g()},400),d.controlsWidgetInstance&&d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"enableControls")):(a.hide(),g&&g())},addMessage:function(a){e=e||avpw$("#avpw_messages"),a&&(e[0].innerHTML+=a)}}}(),d.ControlsWidget.prototype.orientationChanged=function(a){},d.ControlsWidget.prototype.windowResized=function(){var a=null;return function(c){b.clearTimeout(a),a=b.setTimeout(function(){e.trigger("layout:resize"),a=null},500)}}(),d.ControlsWidget.prototype.Slider=function(a){var b=!1,c=function(c,d){!b&&a.onstart&&a.onstart.apply(this,[c,d])},d=function(c,d){!b&&a.onchange&&a.onchange.apply(this,[c,d])},e=function(c,d){!b&&a.onslide&&a.onslide.apply(this,[c,d])},f=avpw$(a.element).slider({range:"min",max:a.max,min:a.min,value:a.defaultValue||a.max/2,delay:a.delay});return this.getValue=function(){return f.slider("value")},this.setValue=function(a){return f.slider("value",a)},this.reset=function(c){b=!0,this.setValue(a.defaultValue),b=!1},this.addListeners=function(){f.bind("slidestart",c).bind("slidechange",d).bind("slide",e)},this.removeListeners=function(){f.unbind("slidestart").unbind("slide").unbind("slidechange")},this.shutdown=function(){f.slider("destroy")},this},d.ControlsWidget.prototype._drawUICircle=function(a,b,c,e,f){d.featherUseFlash||this._drawUICircle_HTML(a,b,c,e,f)},d.ControlsWidget.prototype._drawUICircle_HTML=function(a,b,c,e,f){var g,h=avpw$(a)[0],i=h.getContext("2d");i.clearRect(0,0,h.width,h.height),f&&"transparent"!==e&&this._drawUIGrid(i,h.width,h.height),i.globalCompositeOperation="source-over",null!=c?(f&&("transparent"==c||d.util.color_is_white(c)||null==e)?i.strokeStyle="#444":i.strokeStyle=c,g=3):(i.strokeStyle="rgba(0,0,0,0)",g=1),i.lineWidth=g,i.beginPath(),i.arc(h.width/2,h.height/2,b,0,2*Math.PI,!0),i.stroke(),i.closePath(),null!=e&&(i.save(),i.clip(),f&&"transparent"==e?this._drawUIGrid(i,h.width,h.height):(i.fillStyle=e,i.fillRect(0,0,h.width,h.height)),i.restore())},d.ControlsWidget.prototype._drawUIGrid=function(a,b,c,d){var e,f;for(d||(d=5),f=0;f<c+d;f+=d)for(e=0;e<c+d;e+=d)1==(e+f&1)?a.fillStyle="#fff":a.fillStyle="#ddd",a.fillRect(e,f,d,d)},d.ControlsWidget.prototype.showPanel=function(a){null!=a&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+a).show())},d.ControlsWidget.prototype.save=function(){var a=null,c=!0,f=1e3,g=function(){return{apikey:d.launchData.apiKey,timestamp:d.launchData.timestamp,signature:d.launchData.signature,salt:d.launchData.salt,encryptionmethod:d.launchData.encryptionMethod}},h=function(a,b,c){var e=d.controlsWidgetInstance;if(e.layoutNotify(d.launchData.openType,"enableControls",[!0]),e.paintWidget.showWaitThrobber(!1),a){var f=avpw$(d.util.getImageElem(e.paintImgIdElem));f.avpw_prevURL=a,d.controlsWidget_onImageSaved(a,b)}else d.errorNotify("ERROR_SAVING",[d.build.imgrecvServer,c]),d.controlsWidgetInstance.saving=!1},i=function(a,b){var c=d.controlsWidgetInstance;if(c.layoutNotify(d.launchData.openType,"enableControls",[!0]),c.paintWidget.showWaitThrobber(!1),a){var e=avpw$(d.util.getImageElem(c.paintImgIdElem));e.avpw_prevURL=a,d.controlsWidget_onHiResImageSaved(a)}else d.errorNotify("ERROR_SAVING",[d.build.asyncImgrecvBase,b]),d.controlsWidgetInstance.saving=!1},j=function(a){var b,c,d,e,f="";if("string"==typeof a)b=a.split("---FEATHER-POSTMESSAGE---"),c=b[0],d=b[1];else if(e=avpw$(a).find("error"),e.length>0)f=e.text();else{var g=avpw$(a).find("url");g&&(c=g.text(),c=c.replace(/^\s+|\s+$/g,""));var i=avpw$(a).find("hiresurl");i&&(d=i.text(),d=d.replace(/^\s+|\s+$/g,""))}h(c,d,f)},k=function(){var a=this;a.paintWidget.exportImage(null,function(b){var c,e,f=b.indexOf(";",0),h=b.indexOf(",",f);c=b.slice(5,f),e=b.slice(h+1),b="",d.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:d.build.imgrecvServer,method:"POST",announcer:d.build.featherTargetAnnounce,origin:d.build.imgrecvBase,keyValues:d.util.extend(g(),{file:e,postdata:d.launchData.postData,posturl:d.launchData.postUrl,sessionid:d.usageTracker.getUUID(),actionlist:a.paintWidget.actions.exportJSON(!0),origurl:a.origURL,hiresurl:d.launchData.hiresUrl,contenttype:d.launchData.fileFormat,jpgquality:d.launchData.jpgQuality,debug:d.launchData.debug,asyncsave:d.launchData.asyncSave,usecustomfileexpiration:d.launchData.useCustomFileExpiration,encodedas:"base64text"}),callback:j})})},l=function(){var e=d.util.extend(g(),{actionlist:this.paintWidget.actions.exportJSON(!0),origurl:d.launchData.hiresUrl,fileformat:d.launchData.fileFormat,notificationmethod:"GET",backgroundcolor:"0xffffffff",jpgquality:d.launchData.jpgQuality}),h=function(d){!d||d&&"JobFailed"===d.JobStatusCode?(i(null),b.clearInterval(a)):d&&"JobCompleted"===d.JobStatusCode&&(b.clearInterval(a),i(d.JobStatus)),c=!0},j=function(e){var j;e&&e.JobId?(j=e.JobId,a=b.setInterval(function(){c&&d.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:d.build.asyncImgrecvGetJobStatus,method:"POST",dataType:"json",announcer:d.build.asyncFeatherTargetAnnounce,origin:d.build.asyncImgrecvBase,keyValues:d.util.extend(g(),{jobid:j}),callback:h}),c=!1},f)):i(null)};d.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:d.build.asyncImgrecvCreateJob,method:"POST",dataType:"json",announcer:d.build.asyncFeatherTargetAnnounce,origin:d.build.asyncImgrecvBase,keyValues:e,callback:j})},m=function(a,b,c){var e=this;e.paintWidget.exportImage(c,function(c){var e=d.controlsWidgetInstance;e.saving=!1,e.layoutNotify(d.launchData.openType,"enableControls",[!0]),e.paintWidget.showWaitThrobber(!1),a&&"function"==typeof a&&(b?b=a(c)!==!1:a(c)),b&&d.util.nextFrame(function(){d.controlsWidget_onImageSaved(e.origURL)})})},n=function(a,b,c,e){var f=!d.featherUseFlash;f&&this.layoutNotify(d.launchData.openType,"disableControls"),this.paintWidget.showWaitThrobber(f,function(){switch(a){case"saveHiRes":l.call(g);break;case"getImageData":m.call(g,b,c,e);break;default:k.call(g)}});var g=this;return!1};return function(a,b,c,f){return!(d.controlsWidgetInstance.loaderPhase<2)&&(!this.saving&&(e.trigger("tool:commit"),e.trigger("tool:close"),this.saving=!0,d.prevActionList=this.paintWidget.actions.exportJSON(!0),d.launchData.postData&&"string"!=typeof d.launchData.postData&&(d.launchData.postData=d.JSON.stringify(d.launchData.postData)),n.apply(this,[a,b,c,f])))}}(),d.ControlsWidget.prototype.onSaveButtonClicked=function(a){if(e.trigger("usage:submit","saveclicked"),"function"==typeof d.launchData.onSaveButtonClicked){var b=d.launchData.onSaveButtonClicked.apply(d.launchData,[d.util.getImageId(d.controlsWidgetInstance.paintImgIdElem)]);if(b===!1)return!1}return d.controlsWidgetInstance.save()},d.ControlsWidget.prototype.showAreYouSure=function(){this.messager.show("avpw_aviary_quitareyousure",!0)},d.ControlsWidget.prototype.cancel=function(a){this.quitCount++;var b=this.quitCount>0&&this.paintWidget&&this.paintWidget.dirty;if("function"==typeof d.launchData.onCloseButtonClicked){var c=d.launchData.onCloseButtonClicked.apply(d.launchData,[b]);if(c===!1)return!1}return b?this.showAreYouSure():d.paintWidgetCloser(),!1},d.ControlsWidget.prototype.getScaledDims=function(a,b){return d.util.getScaledDims(a,b,this.maxWidth,this.maxHeight)},d.TransformStyle=function(a){var b=this,c=a||"";return b.set=function(a){if(c)for(var b in a){var d=b+"\\([^\\)]*",e=new RegExp(d),f=!1,g=function(c,d,e){return f=!0,b+"("+a[b]};c=c.replace(e,g),f||(c+=" "+b+"("+a[b]+")")}else for(var b in a)c+=" "+b+"("+a[b]+")"},b.serialize=function(){return c},b},a}(this,"undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{}),function(a,b,c){a.errorNotify=function(b,c){var d={BAD_IMAGE:{code:1,message:"There was a problem loading your image provided to the `image` config key. Either it's not actually an image file or it doesn't really exist."},UNSUPPORTED:{code:2,message:"It looks like you're using a browser that doesn't support the HTML canvas element (and also doesn't have Flash installed either). Please try accessing this page through a modern browser like Chrome, Firefox, Safari, or Internet Explorer (version 9 or higher). Your internets will thank you."},BAD_URL:{code:3,message:"There was a problem loading your image provided by URI to the `url` config key. It is not reachable by the public (and our service at "+(a.featherUseFlash?a.build.proxyServer:a.build.imgrecvBase)+")"},UNSUPPORTED_TOOL:{code:4,message:"So sorry, but this tool is not available because it is not part of the set chosen with the `tools` config key. It's alternatively possible that your browser does not support this specific tool."},IMAGE_NOT_CLEAN:{code:5,message:"Uh oh! We can't edit this image because the editor wasn't set up correctly to load external files via their address. You must either provide images from the same domain as the web page with the editor OR pass the external image address via the `url` config key in order for Aviary to be able to get permission from the browser to open it for editing. Sorry for the inconvenience!"},UNSUPPORTED_FONT:{code:6,message:"So sorry, but this font looks to be unsupported by your browser or platform"},ERROR_SAVING:{code:7,message:"There was a problem saving your photo. Please try again."},NO_APIKEY:{code:8,message:"apiKey is required and not provided. See http://www.aviary.com/web-documentation#constructor-config-apikey."},ERROR_AUTHENTICATING:{code:9,message:"There was a problem retrieving access to content from our server. Please ensure all authentication keys are present or do not attempt premium partner authentication."}},e=function(a){},f=d[b],g=f.message;return"function"==typeof a.launchData.onError&&(f.args=c,g=a.launchData.onError(f)||g),g&&e(g),g}}(window.AV||(window.AV={}),window,document),function(a,b,c){a.AV=a.AV||{};var d=a.AV,e=d.Events;a.Aviary=d,d.feather_loaded=!1,d.feather_loading=!1,d.build=d.build||{version:"",imgrecvServer:"imgrecvserver",flashGatewayServer:"",imgrecvBase:"",inAppPurchaseFrameURL:"",imgtrackServer:"imgtrackserver",filterServer:"",jsonp_imgserver:"",featherTargetAnnounce:"feather_target_announce_v3.html",proxyServer:"",feather_baseURL:"",feather_stickerURL:"",googleTracker:"",MINIMUM_FLASH_PLAYER_VERSION:"10.2.0"},d.defaultTools=["enhance","effects","frames","overlay","crop","resize","orientation","focus","brightness","contrast","saturation","warmth","sharpness","colorsplash","drawing","textwithfont","redeye","whiten","blemish"],d.flashSupportedTools=["enhance","effects","overlay","crop","resize","orientation","brightness","contrast","saturation","sharpness","drawing","text","redeye","blemish"];var f={};return f.image=null,f.apiKey=void 0,f.apiVersion=1,f.appendTo=null,f.language="en",f.minimumStyling=!1,f.maxSize=800,f.noCloseButton=!1,f.launchDelay=300,f.closeDelay=300,f.tools=void 0,f.initTool="",f.cropPresets=["Original","Custom",["Square","1:1"],"3:2","3:5","4:3","4:5","4:6","5:7","8:10","16:9"],f.cropPresetDefault="Custom",f.cropPresetsStrict=!1,f.url=null,f.postUrl=void 0,f.postData=null,f.fileFormat="",f.jpgQuality=100,f.displayImageSize=!1,f.hiresMaxSize=1e4,f.hiresWidth=null,f.hiresHeight=null,f.onLoad=void 0,f.onReady=void 0,f.onSaveButtonClicked=void 0,f.onSave=void 0,f.onSaveHiRes=void 0,f.onClose=void 0,f.onError=void 0,f.signature=null,f.timestamp=null,f.hiresUrl=void 0,f.useCustomFileExpiration=!1,f.allowInAppPurchase=!1,f.forceFlash=!1,f.forceSupport=!1,f.poweredByURL="http://www.aviary.com",f.giveFeedbackURL="http://www.aviary.com/feature-requests",f.getWidgetURL="http://www.aviary.com",f.debug=!1,f.asyncSave=!0,d.baseConfig=f,function(a){var b=function(a){return{language:a.Feather_Language,forceFlash:a.Feather_ForceFlash,forceSupport:a.AV_Feather_ForceSupport,onLoad:a.Feather_OnLoad,onReady:a.Feather_OnLaunchComplete,onClose:a.Feather_OnClose,onSave:a.Feather_OnSave,noCloseButton:a.Feather_NoCloseButton,maxSize:a.Feather_MaxSize||a.Feather_MaxDisplaySize,tools:a.Feather_EditOptions,cropPresets:a.Feather_CropSizes,resizePresets:a.Feather_ResizeSizes,apiKey:a.Feather_APIKey,hiresUrl:a.Feather_HiResURL,postUrl:a.Feather_PostURL,fileFormat:a.Feather_FileFormat||a.Feather_ContentType,jpgQuality:a.Feather_FileQuality,signature:a.Feather_Signature,timestamp:a.Feather_Timestamp}};if(d.baseConfig=d.util.extend(d.baseConfig,b(a)),"https:"==a.location.protocol||"chrome-extension:"==a.location.protocol){var c,e;for(var f in d.build)e=f.split("_SSL"),2===e.length&&d.build[f]&&(c=e[0],d.build[c]=d.build[f])}(a.Feather_Theme||a.Feather_OpenType||a.Feather_APIKey)&&d.util.nextFrame(function(){var c=new d.Feather(d.baseConfig);a.aviaryeditor=function(e,f,g,h){d.launchData=d.util.extend(d.baseConfig,b(a));var i=d.util.extend(d.launchData,{image:e,url:f,postData:g,appendTo:h});c.launch(i)},a.aviaryeditor_close=c.close,a.aviaryeditor_relaunch=c.relaunch,a.aviaryeditor_activatetool=c.activateTool,a.aviarynewimage=c.replaceImage})}(b),d.getLocalizedString=function(a){try{var b=d.lang[d.launchData.language][a];return void 0===b&&(b=a),b}catch(a){}return a},Function.prototype.AV_bindInst=function(a){var b=this;return function(){return b.apply(a,arguments)}},d.injectControls=function(){var a,b;if("popup"==d.launchData.openType?(a="",b=d.template[d.launchData.layout].saveBlock()):(a=d.template[d.launchData.layout].saveBlock(),b=""),d.criticalLayoutStyles&&!d.feather_loaded){var e=c.createElement("style");e.type="text/css";var f=c.createTextNode(d.criticalLayoutStyles);e.styleSheet?e.styleSheet.cssText=f.nodeValue:e.appendChild(f);var g=c.getElementsByTagName("head")[0];g.appendChild(e)}var h=d.template[d.launchData.layout].controls({internalSaveBlock:a,externalSaveBlock:b}),i=c.createElement("div");i.id="avpw_holder";var j="";d.featherUseFlash&&(j="avpw_flash "),d.msie&&(j+="avpw_ie"+d.msie),j&&(i.className=j);var k=c.getElementsByTagName("body");k&&(k=k[0]),k||(k=c.documentElement),k.appendChild(i),i.innerHTML=h},d.Feather=function(a){var b=this,f=function(){d.injectControls(),d.util.nextFrame(d.loadStageFinal)},g=function(){"undefined"!=typeof avpw$?avpw$(c).ready(f):f()};a&&(a.openType="aviary",a.layout="desktop"),a=a||{},d.launchData=d.util.extend(d.baseConfig,a),function(){function a(a){var b=d.build.feather_baseURL+"css/"+a;d.util.loadFile(b+".css","css")}var b,c;d.featherUseFlash=!d.featherHtmlOk()&&d.featherFlashOk(),d.launchData.language=d.launchData.language.toLowerCase(),d.feather_loaded||d.feather_loading||(d.feather_loading=!0,b=d.launchData.language||"en",c="js/feathercontrols_desktop",c+=d.validLanguages&&d.validLanguages[b]?"_"+b+".js":"_en.js",a(d.launchData.minimumStyling?"feather_core":"feather_theme_aviary"),d.util.loadFile(d.build.feather_baseURL+"images/aviary_atlas.png","img"),d.build.bundled?g():d.util.loadFile(d.build.feather_baseURL+c,"js",g))}();var h=function(){if(d.paintWidgetInstance)return!1;var a=d.util.getImageElem(d.launchData.image);d.paintWidgetLauncher(a,d.launchData.url)};return b.launch=function(a){if(!d.feather_loaded)return!1;var e=c.getElementById("avpw_holder");if(e||d.injectControls(),d.paintWidgetInstance){if(e)return!1;b.close(!0)}if(a&&a.language&&delete a.language,d.launchData=a?d.util.extend(d.launchData,a):d.launchData,!d.launchData.image)return d.errorNotify("BAD_IMAGE"),!1;if(d.launchData.image=d.util.getImageElem(d.launchData.image),d.featherUseFlash)h();else{if(!d.featherSupported())return d.errorNotify("UNSUPPORTED")&&(d.controlsWidgetInstance=new d.ControlsWidget,d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"placeControls",[2===d.util.getApiVersion(d.launchData)?d.launchData.appendTo:void 0]),d.controlsWidgetInstance.bindControls(),c.getElementById("avpw_controls").style.display="block",d.controlsWidgetInstance.messager.show("avpw_aviary_unsupported",!0)),!0;d.util.nextFrame(h)}return!0},b.showWaitIndicator=function(){return!(!d.controlsWidgetInstance||!d.controlsWidgetInstance.showWaitThrobber)&&(d.controlsWidgetInstance.showWaitThrobber(!0),!0)},b.hideWaitIndicator=function(){return!(!d.controlsWidgetInstance||!d.controlsWidgetInstance.showWaitThrobber)&&(d.controlsWidgetInstance.showWaitThrobber(!1),!0)},b.getImageDimensions=function(){var a=null;return d.paintWidgetInstance&&(a=d.paintWidgetInstance.getScaledSize(),d.launchData.hiresWidth&&d.launchData.hiresHeight||(delete a.hiresWidth,delete a.hiresHeight)),a},b.save=function(){return!!d.paintWidgetInstance&&d.controlsWidgetInstance.save()},b.saveHiRes=function(){return!!d.paintWidgetInstance&&d.controlsWidgetInstance.save("saveHiRes")},b.getImageData=function(a,b,c){return!!d.paintWidgetInstance&&d.controlsWidgetInstance.save("getImageData",a,b,c)},b.close=function(a){return!!d.paintWidgetInstance&&void d.paintWidgetCloser(a)},b.relaunch=function(){return e.trigger("usage:interact","api","relaunch"),d.isRelaunched=!0,!!d.launchData&&void b.launch(d.launchData)},b.activateTool=function(a){e.trigger("tool:open",a,d.controlsWidgetInstance)},b.replaceImage=function(a){return e.trigger("usage:interact","api","replaceImage"),!!d.launchData&&(b.close(!0),void d.util.nextFrame(function(){d.launchData.url=a,b.launch(d.launchData)}))},b.updateConfig=function(a,b){if(!d.launchData)return!1;if(a&&"object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&(d.launchData[c]=a[c]);else{if(!a||"string"!=typeof a)return!1;d.launchData[a]=b}},b.getIsDirty=function(){return!!d.paintWidgetInstance&&d.paintWidgetInstance.dirty},b.getActionList=function(){return d.paintWidgetInstance?(e.trigger("tool:commit"),d.paintWidgetInstance.actions.exportJSON(!0)):void 0},b.disableControls=function(){d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"disableControls")},b.enableControls=function(){d.controlsWidgetInstance.layoutNotify(d.launchData.openType,"enableControls")},b.on=function(a,b){e&&a&&b&&"function"==typeof b&&e.on(a,b)},b.off=function(a,b){e&&a&&b&&"function"==typeof b&&e.off(a,b)},b},d.loadStageFinal=function(){d.feather_loaded=!0,"function"==typeof d.launchData.onLoad&&d.launchData.onLoad()},d.featherSupported=function(){return d.featherHtmlOk()||d.featherFlashOk()||d.launchData.forceSupport},d.featherFlashOk=function(){return!!d.launchData.forceFlash||avpw_swfobject&&avpw_swfobject.hasFlashPlayerVersion(d.build.MINIMUM_FLASH_PLAYER_VERSION)},d.featherHtmlOk=function(){if(d.launchData.forceFlash)return!1;var a=!!c.createElement("canvas").getContext,e="function"==typeof b.postMessage;return a&&e},d.getFlashMovie=function(a){var d=b[a]||c[a];return d},d.msie=function(){for(var a,b=3,d=c.createElement("div"),e=d.getElementsByTagName("i");d.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",e[0];);return b>4?b:a}(),d.firefox=function(){var a;return"Gecko"===b.navigator.product&&(a=navigator.userAgent.split("Firefox/")[1],a=parseInt(a,10)),a}(),d.PAGE_WIDTH=360,d.setPageWidth=function(a){d.PAGE_WIDTH=a},a}(this,"undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{}),
function(a,b,c){a.support=function(a){var b,d=a.navigator.userAgent,e=a.screen.width,f=(a.screen.height,{0:/Android/i,1:/webOS/i,2:/iPhone/i,3:/iPod/i,4:/BlackBerry/i,5:/iPad/i}),g=0,h=0,i=0,j=0;for(var k in f)d.match(f[k])&&(g=1,b=parseInt(k));if(d.match(/AppleWebKit/i)&&(h=1),0===b&&(i=1),1===i){var l=d.match(/Android [0-9].[0-9]/).toString();l&&(j=parseFloat(l.split("Android ")[1]))}var m={};return m.isAppleWebkit=function(){return 1===h},m.isMobileWebkit=function(){return 1===h&&e&&(e<=480||j>0&&j<=2.3)},m.isIPhoneOrIPod=function(){return 2===b||3===b},m.isAndroid=function(){return 1===i},m.getAndroidVersion=function(){return j},m.getVendorProperty=function(){var a={},b=function(a,b){var c,d,e=["webkit","ms","Moz","O"],f=a.style;if(void 0!==f[b])return b;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<e.length;d++)if(c=e[d]+b,void 0!==f[c])return c};return function(d){return a[d]||(a[d]=b(c.createElement("div"),d))}}(),m}(b)}(window.AV||(window.AV={}),window,document);